<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TersaaMt</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://s3.tradingview.com/tv.js"></script>
    <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
    <script src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.8.1/dist/dotlottie-wc.js" type="module"></script>
    <!-- Service Worker –¥–ª—è Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <script>
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker
        if ('serviceWorker' in navigator && 'PushManager' in window) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration);
                    })
                    .catch(error => {
                        console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
                    });
            });
        } else {
            console.log('‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Service Worker –∏–ª–∏ Push API');
        }
    </script>
    <script type="module" src="js/firebase.js"></script>
    <link rel="stylesheet" href="css/styles.css">

    <!-- Canvas Strategies Styles (injected) -->
    <style>
      .canvas-container { background: rgba(0,0,0,0.3); border-radius: 15px; padding: 10px; margin: 20px 0; overflow: hidden; }
      #strategyCanvas { width: 100%; height: 500px; border-radius: 10px; cursor: crosshair; display: block; background:#0a0e27; }
      .chart-controls { display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap; align-items: center; }
      .chart-controls select, .chart-controls button { padding: 10px 15px; border-radius: 8px; border: none; background: rgba(79, 172, 254, 0.2); color: #fff; cursor: pointer; font-size: 14px; }
      .chart-info-bar { display: flex; justify-content: space-between; margin: 10px 0; font-size: 12px; color: #b8c5d1; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px; }
      .signal-detail-box { background: rgba(79, 172, 254, 0.1); border-left: 4px solid #4facfe; padding: 15px; margin: 15px 0; border-radius: 8px; }
      .signal-badge { display:inline-block; padding:4px 8px; border-radius:8px; font-weight:700; margin-bottom:8px; }
      .signal-badge.signal-buy { background: rgba(0,200,81,.15); color:#00c851; }
      .signal-badge.signal-sell { background: rgba(239,83,80,.15); color:#ef5350; }
      .signal-badge.signal-neutral { background: rgba(184,197,209,.15); color:#b8c5d1; }
.floating-back-btn { 
    position: fixed !important; 
    top: 20px !important; 
    right: 90px !important;
    z-index: 999 !important;
    background: transparent;
    border: none;
    color: #4facfe;
    padding: 5px;
    border-radius: 0;
    cursor: pointer;
    font-size: 24px;
    font-weight: bold;
    display: none;
}
.floating-back-btn.show { display: block !important; }
    </style>

</head>
    <div class="header">
        <div class="logo">TersaaMt</div>
       <div class="header-right">
    <button class="floating-back-btn" id="floatingBackBtn" onclick="goBackToStrategies()" title="–ù–∞–∑–∞–¥">‚Üê</button>
    <button class="invite-btn" onclick="inviteFriend()" title="–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞">...</button>
    <button class="invite-btn" onclick="showProfile()" title="–ü—Ä–æ—Ñ–∏–ª—å" style="margin-right: 10px;">üë§</button>
    <button class="settings-btn" onclick="toggleSettingsDropdown()">‚öôÔ∏è</button>
</div>
         
    
        <div class="settings-dropdown" id="settingsDropdown">
            <!-- –Ø–∑—ã–∫–∏ -->
            <div class="settings-section">
                <div class="settings-title">
                    üî§ –Ø–∑—ã–∫
                </div>
                <div class="settings-option" onclick="setLanguage('ru')">
                    <span style="margin-right: 10px;">üá∑üá∫</span> –†—É—Å—Å–∫–∏–π
                </div>
                <div class="settings-option" onclick="setLanguage('en')">
                    <span style="margin-right: 10px;">üá¨üáß</span> English
                </div>
                <div class="settings-option" onclick="setLanguage('uz')">
                    <span style="margin-right: 10px;">üá∫üáø</span> O'zbek
                </div>
                <div class="settings-option" onclick="setLanguage('ja')">
                    <span style="margin-right: 10px;">üáØüáµ</span> Japanese
                </div>
            </div>
<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<div class="settings-section">
    <div class="settings-title">
        üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    </div>
    <div class="settings-option" onclick="toggleNotifications()">
        <span style="margin-right: 10px;">üîî</span> –í–∫–ª—é—á–∏—Ç—å Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    </div>
    <div class="settings-option" onclick="testNotification()">
        <span style="margin-right: 10px;">üß™</span> –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    </div>
</div>
<!-- Premium –î–æ—Å—Ç—É–ø -->
<div class="settings-section">
    <div class="settings-title">
        üíé Premium –î–æ—Å—Ç—É–ø
    </div>
    <div class="settings-option" onclick="showPremiumModal()">
        <span style="margin-right: 10px;">‚≠ê</span> –ö—É–ø–∏—Ç—å Premium ($15)
    </div>
</div>
            <!-- –¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞ -->
            <div class="settings-section">
                <div class="settings-title">
                    üìâ –¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞
                </div>
                <div class="settings-option" onclick="setChartType('candles')">
                    <span style="margin-right: 10px;">üïØÔ∏è</span> –Ø–ø–æ–Ω—Å–∫–∏–µ —Å–≤–µ—á–∏
                </div>
                <div class="settings-option" onclick="setChartType('bars')">
                    <span style="margin-right: 10px;">üìä</span> –ë–∞—Ä—ã
                </div>
            </div>

            <!-- –ü—Ä–æ–º–æ–∫–æ–¥ -->
            <div class="settings-section">
                <div class="settings-title">
                    üéÅ –ü—Ä–æ–º–æ–∫–æ–¥
                </div>
                <input type="text" class="promo-input" id="promoInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥">
                <button class="promo-btn" onclick="activatePromo()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>

            <!-- FAQ -->
            <div class="settings-section">
                <div class="settings-title">
                    ‚ùì FAQ
                </div>
                <div class="settings-option" onclick="showFAQ()">
                    <span style="margin-right: 10px;">üìã</span> –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã
                </div>
            </div>
        </div>
    </div>


    <!-- –≠–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="authScreen" class="auth-screen">
        <!-- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω —Å —á–∞—Å—Ç–∏—Ü–∞–º–∏ -->
        <div id="particles-js"></div>
        
        <h1 class="auth-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</h1>
        <form id="authForm" style="position: relative; z-index: 10;">
            <div class="form-group">
                <label class="form-label">–ò–º—è</label>
                <input type="text" class="form-input" id="firstName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" required>
            </div>
            <div class="form-group">
                <label class="form-label">–§–∞–º–∏–ª–∏—è</label>
                <input type="text" class="form-input" id="lastName" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é" required>
            </div>
            <div class="form-group">
                <label class="form-label">–ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                <input type="number" class="form-input" id="birthYear" placeholder="1990" min="1950" max="2010" required>
            </div>
            <div class="form-group">
                <label class="form-label">–û–ø—ã—Ç –≤ —Ç—Ä–µ–π–¥–∏–Ω–≥–µ</label>
                <select class="form-select" id="experience" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—ã—Ç</option>
                    <option value="beginner">–ù–æ–≤–∏—á–æ–∫ (0-6 –º–µ—Å—è—Ü–µ–≤)</option>
                    <option value="intermediate">–°—Ä–µ–¥–Ω–∏–π (6 –º–µ—Å—è—Ü–µ–≤ - 2 –≥–æ–¥–∞)</option>
                    <option value="advanced">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π (2-5 –ª–µ—Ç)</option>
                    <option value="expert">–≠–∫—Å–ø–µ—Ä—Ç (5+ –ª–µ—Ç)</option>
                </select>
            </div>
            <button type="submit" class="btn-primary">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </form>
    </div>
<!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π -->
<div id="lessonsPage" class="page active">
  <div class="section" style="position:relative; height: 300px; overflow:hidden; margin-bottom: 20px; display: flex; align-items: center; justify-content: center;">
    <canvas id="dragonCanvas" style="display: block;"></canvas>
  </div> 
<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é -->
<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
  }
}
</script>
<script type="module" src="js/dragon-animation.js"></script>



                <!-- –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã–π —Ç–∏–∫–µ—Ä —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ -->
                <div class="crypto-ticker">
                    <div class="crypto-ticker-content">
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #f7931a, #ffb74d);">‚Çø</div>
                            <span class="crypto-symbol">BTC</span>
                            <span class="crypto-price" id="btcPrice">$0</span>
                            <span class="crypto-change" id="btcChange">0%</span>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #627eea, #8fa4f3);">Œû</div>
                            <span class="crypto-symbol">ETH</span>
                            <span class="crypto-price" id="ethPrice">$0</span>
                            <span class="crypto-change" id="ethChange">0%</span>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #26a17b, #4caf50);">‚ÇÆ</div>
                            <span class="crypto-symbol">USDT</span>
                            <span class="crypto-price">$1.00</span>
                            <span class="crypto-change">+0.01%</span>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #23292f, #4a5568);">‚äó</div>
                            <span class="crypto-symbol">XRP</span>
                            <span class="crypto-price" id="xrpPrice">$0</span>
                            <span class="crypto-change" id="xrpChange">0%</span>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #f3ba2f, #fdd835);">B</div>
                            <span class="crypto-symbol">BNB</span>
                            <span class="crypto-price" id="bnbPrice">$0</span>
                            <span class="crypto-change" id="bnbChange">0%</span>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #9945ff, #14f195);">‚óé</div>
                            <span class="crypto-symbol">SOL</span>
                            <span class="crypto-price" id="solPrice">$0</span>
                            <span class="crypto-change" id="solChange">0%</span>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #0033ad, #3f51b5);">‚Ç≥</div>
                            <span class="crypto-symbol">ADA</span>
                            <span class="crypto-price" id="adaPrice">$0</span>
                            <span class="crypto-change" id="adaChange">0%</span>
                        </div>
                    </div>
                </div>

                <!-- –í–∏–¥–µ–æ —É—Ä–æ–∫–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –ø–æ–¥ –∫–æ—Ç–∏—Ä–æ–≤–∫–∏ -->
                <div class="video-lessons-section" onclick="showVideos()">
                    <h2 class="video-lessons-title">üìö –í–∏–¥–µ–æ —É—Ä–æ–∫–∏</h2>
                    
                    <div style="text-align: center; padding: 40px 20px; color: #b8c5d1; cursor: pointer;">
                        <div style="font-size: 48px; margin-bottom: 20px;">üìö</div>
                        <p style="font-size: 18px; line-height: 1.6;">
                            –°–∫–æ—Ä–æ —Ç—É—Ç –±—É–¥—É—Ç –æ–±—É—á–∞—é—â–∏–µ –≤–∏–¥–µ–æ—É—Ä–æ–∫–∏.
                        </p>
                    </div>
                </div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ -->
            <div id="strategiesPage" class="page">
                <!-- –°–µ–ª–µ–∫—Ç–æ—Ä –º–æ–Ω–µ—Ç -->
                <div class="coin-selector">
                    <button class="coin-btn active" onclick="selectCoin('BTCUSDT')" data-coin="BTCUSDT">
                        <div class="crypto-icon" style="background: linear-gradient(45deg, #f7931a, #ffb74d); width: 16px; height: 16px; font-size: 8px;">‚Çø</div>
                        BTC
                    </button>
                    <button class="coin-btn" onclick="selectCoin('ETHUSDT')" data-coin="ETHUSDT">
                        <div class="crypto-icon" style="background: linear-gradient(45deg, #627eea, #8fa4f3); width: 16px; height: 16px; font-size: 8px;">Œû</div>
                        ETH
                    </button>
                    <button class="coin-btn" onclick="selectCoin('BNBUSDT')" data-coin="BNBUSDT">
                        <div class="crypto-icon" style="background: linear-gradient(45deg, #f3ba2f, #fdd835); width: 16px; height: 16px; font-size: 8px;">B</div>
                        BNB
                    </button>
                    <button class="coin-btn" onclick="selectCoin('SOLUSDT')" data-coin="SOLUSDT">
                        <div class="crypto-icon" style="background: linear-gradient(45deg, #9945ff, #14f195); width: 16px; height: 16px; font-size: 8px;">‚óé</div>
                        SOL
                    </button>
                    <button class="coin-btn" onclick="selectCoin('XRPUSDT')" data-coin="XRPUSDT">
                        <div class="crypto-icon" style="background: linear-gradient(45deg, #23292f, #4a5568); width: 16px; height: 16px; font-size: 8px;">‚äó</div>
                        XRP
                    </button>
                    <button class="coin-btn" onclick="selectCoin('ADAUSDT')" data-coin="ADAUSDT">
                        <div class="crypto-icon" style="background: linear-gradient(45deg, #0033ad, #3f51b5); width: 16px; height: 16px; font-size: 8px;">‚Ç≥</div>
                        ADA
                    </button>
                </div>

                <div class="section">
                    <h2 class="section-title">üìà –¢–æ—Ä–≥–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</h2>
                    
                    <div id="mainChart" style="height: 500px; border-radius: 15px; overflow: hidden; margin: 20px 0;"></div>
                    


<!-- –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ -->
                <div style="margin: 20px; margin-bottom: 25px; cursor: pointer;" onclick="showStrategy('TREND')">
                    <div style="width: 100%; height: 1px; background: linear-gradient(90deg, transparent 0%, rgba(0, 200, 81, 0.3) 20%, rgba(0, 200, 81, 0.8) 50%, rgba(0, 200, 81, 0.3) 80%, transparent 100%); margin-bottom: 10px;"></div>
                    <div style="text-align: center; font-size: 16px; font-weight: 600; color: #00c851; margin: 8px 0;">TREND</div>
                    <div class="signal-indicator signal-neutral" id="TRENDSignal">–ê–Ω–∞–ª–∏–∑...</div>
                    <div style="width: 100%; height: 1px; background: linear-gradient(90deg, transparent 0%, rgba(0, 200, 81, 0.3) 20%, rgba(0, 200, 81, 0.8) 50%, rgba(0, 200, 81, 0.3) 80%, transparent 100%); margin-top: 10px;"></div>
                </div>
                
                <div style="margin: 20px; margin-bottom: 25px; cursor: pointer;" onclick="showStrategy('trendline')">
                    <div style="width: 100%; height: 1px; background: linear-gradient(90deg, transparent 0%, rgba(255, 107, 53, 0.3) 20%, rgba(255, 107, 53, 0.8) 50%, rgba(255, 107, 53, 0.3) 80%, transparent 100%); margin-bottom: 10px;"></div>
                    <div style="text-align: center; font-size: 16px; font-weight: 600; color: #ff6b35; margin: 8px 0;">–ü—Ä–æ–±–æ–π —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –ª–∏–Ω–∏–∏</div>
                    <div class="signal-indicator signal-neutral" id="trendlineSignal">–ê–Ω–∞–ª–∏–∑...</div>
                    <div style="width: 100%; height: 1px; background: linear-gradient(90deg, transparent 0%, rgba(255, 107, 53, 0.3) 20%, rgba(255, 107, 53, 0.8) 50%, rgba(255, 107, 53, 0.3) 80%, transparent 100%); margin-top: 10px;"></div>
                </div>

                <div style="margin: 20px; margin-bottom: 25px; cursor: pointer;" onclick="showStrategy('channel')">
                    <div style="width: 100%; height: 1px; background: linear-gradient(90deg, transparent 0%, rgba(156, 39, 176, 0.3) 20%, rgba(156, 39, 176, 0.8) 50%, rgba(156, 39, 176, 0.3) 80%, transparent 100%); margin-bottom: 10px;"></div>
                    <div style="text-align: center; font-size: 16px; font-weight: 600; color: #9c27b0; margin: 8px 0;">–¢—Ä–µ–Ω–¥–æ–≤—ã–π –∫–∞–Ω–∞–ª</div>
                    <div class="signal-indicator signal-neutral" id="channelSignal">–ê–Ω–∞–ª–∏–∑...</div>
                    <div style="width: 100%; height: 1px; background: linear-gradient(90deg, transparent 0%, rgba(156, 39, 176, 0.3) 20%, rgba(156, 39, 176, 0.8) 50%, rgba(156, 39, 176, 0.3) 80%, transparent 100%); margin-top: 10px;"></div>
                </div>
            </div>
        </div>

<!-- üß≠ –î–µ—Ç–∞–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ -->
<div id="strategyDetail" class="page">
  <div class="section">
    <h2 class="section-title" id="strategyDetailTitle"></h2>
    <div id="strategyDetailContent"></div>

    <!-- üí° –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∞ —Å–∏–≥–Ω–∞–ª–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ -->
    <div id="strategyLiveCard" style="max-width:420px; margin:20px auto 10px;">
      <div id="signalCard"
           style="
             background: rgba(25,25,40,0.8);
             border-radius: 14px;
             padding: 15px;
             color: #fff;
             display: block;
             width: 100%;
             box-shadow: 0 0 20px rgba(0,0,0,0.4);">
        <p style="opacity: .7;">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏–≥–Ω–∞–ª–∞...</p>
      </div>
    </div>
  </div>
</div>
     


            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ù–∞—à–∞ —Å–µ–º—å—è -->
            <div id="familyPage" class="page">
                <div class="section">
                    <h2 class="section-title">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –ù–∞—à–∞ —Å–µ–º—å—è</h2>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å" -->
                    <div style="margin-bottom: 30px;">
                        <button class="btn-primary" onclick="showProfile()" style="background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%); margin-top: 0;">
                            üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å
                        </button>
                    </div>
                    
                    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–µ–º—å–∏ -->
                    <div id="familyMembers">
                        <div style="background: rgba(255, 255, 255, 0.08); border-radius: 15px; padding: 20px; margin-bottom: 15px; display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: linear-gradient(45deg, #4facfe, #00f2fe); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; color: white;">
                                üë§
                            </div>
                            <div style="flex: 1;">
                                <div style="color: #ffffff; font-weight: bold; margin-bottom: 5px;" id="familyUserName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                                <div style="color: #4facfe; font-size: 14px;" id="familyUserExp">–ù–æ–≤–∏—á–æ–∫ ‚Ä¢ 0 –æ—á–∫–æ–≤</div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.1); color: #b8c5d1; padding: 4px 8px; border-radius: 10px; font-size: 12px; font-weight: bold;">
                                FREE
                            </div>
                        </div>
                    </div>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ–º—å–∏ -->
                    <div style="background: rgba(255, 255, 255, 0.08); border-radius: 15px; padding: 20px; margin-top: 30px;">
                        <h4 style="color: #ffc107; margin-bottom: 15px;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ–º—å–∏</h4>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="color: #b8c5d1;">–í—Å–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</span>
                            <span style="color: #ffffff; font-weight: 500;">4 —á–µ–ª–æ–≤–µ–∫–∞</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="color: #b8c5d1;">–û–±—â–∏–µ –æ—á–∫–∏:</span>
                            <span style="color: #00f2fe; font-weight: 500;">2,773 –æ—á–∫–∞</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #b8c5d1;">–ú–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ:</span>
                            <span style="color: #ffc107; font-weight: 500;">#1247</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ù–æ–≤–æ—Å—Ç–∏ -->
            <div id="newsPage" class="page">
                <div class="section">
                    <h2 class="section-title">üì∞ –ù–æ–≤–æ—Å—Ç–∏ —Ä—ã–Ω–∫–∞</h2>
                    
                    <!-- –¢–∞–±—ã –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; padding: 0 10px;">
                        <button onclick="switchNewsSource('marketwatch')" class="news-tab active" id="marketwatch-tab" style="flex: 1; padding: 10px; border: none; border-radius: 8px; background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%); color: white; font-weight: bold; cursor: pointer;">
                            üìà MarketWatch
                        </button>
                        <button onclick="switchNewsSource('tradingview')" class="news-tab" id="tradingview-tab" style="flex: 1; padding: 10px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: white; font-weight: bold; cursor: pointer;">
                            üìä TradingView
                        </button>
                        <button onclick="switchNewsSource('api')" class="news-tab" id="api-tab" style="flex: 1; padding: 10px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: white; font-weight: bold; cursor: pointer;">
                            üîî Live API
                        </button>
                    </div>
                    
                    <!-- MarketWatch –≤–∏–¥–∂–µ—Ç -->
                    <div id="marketwatch-news" class="news-container active" style="border-radius: 15px; overflow: hidden; height: 600px;">
                        <!-- MarketWatch RSS –≤–∏–¥–∂–µ—Ç -->
                        <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; height: 100%; overflow-y: auto;">
                            <div id="marketwatch-content">
                                <div style="text-align: center; padding: 40px; color: #b8c5d1;">
                                    <div style="font-size: 48px; margin-bottom: 20px;">üìà</div>
                                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π MarketWatch...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- TradingView –≤–∏–¥–∂–µ—Ç -->
                    <div id="tradingview-news" class="news-container" style="display: none; border-radius: 15px; overflow: hidden; height: 600px;">
                        <!-- TradingView Timeline –≤–∏–¥–∂–µ—Ç -->
                        <div class="tradingview-widget-container" style="height: 100%;">
                            <div class="tradingview-widget-container__widget" style="height: calc(100% - 32px);"></div>
                            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-timeline.js" async>
                            {
                                "feedMode": "all_symbols",
                                "colorTheme": "dark",
                                "isTransparent": true,
                                "displayMode": "adaptive",
                                "width": "100%",
                                "height": "100%",
                                "locale": "ru"
                            }
                            </script>
                        </div>
                    </div>
                    
                    <!-- API –Ω–æ–≤–æ—Å—Ç–∏ -->
                    <div id="api-news" class="news-container" style="display: none; border-radius: 15px; overflow: hidden; height: 600px;">
                        <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; height: 100%; overflow-y: auto;">
                            <div id="api-news-content">
                                <div style="text-align: center; padding: 40px; color: #b8c5d1;">
                                    <div style="font-size: 48px; margin-bottom: 20px;">üîî</div>
                                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
            <div id="analyticsPage" class="page">
                <div class="section">
                    <h2 class="section-title">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
                    
                    <div style="background: rgba(255, 255, 255, 0.08); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="color: #00f2fe; margin-bottom: 15px;">üìà –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="color: #b8c5d1;">–ü–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤:</span>
                            <span style="color: #ffffff; font-weight: 500;" id="userSignalsCount">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="color: #b8c5d1;">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π:</span>
                            <span style="color: #ffffff; font-weight: 500;" id="strategiesUsedCount">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #b8c5d1;">–î–Ω–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ:</span>
                            <span style="color: #ffffff; font-weight: 500;" id="daysInSystemCount">0</span>
                        </div>
                    </div>
                    
                    <div style="text-align: center; padding: 40px 20px; color: #b8c5d1; margin-top: 30px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">üìà</div>
                        <h3 style="color: #00f2fe; margin-bottom: 15px;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                        <p style="line-height: 1.6;">
                            ‚Ä¢ –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∞—à–∏—Ö —Å–¥–µ–ª–æ–∫<br>
                            ‚Ä¢ –ò—Å—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π<br>
                            ‚Ä¢ –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤<br>
                            ‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
                        </p>
                    </div>
                </div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ -->
            <div id="supportPage" class="page">
                <div class="section">
                    <h2 class="section-title">üõü –ü–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
                    <form id="supportForm">
                        <div class="form-group">
                            <label class="form-label">–ò–º—è</label>
                            <input type="text" class="form-input" id="supportName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–¢–µ–º–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è</label>
                            <input type="text" class="form-input" id="supportSubject" placeholder="–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea class="form-input" id="supportDescription" rows="5" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É –∏–ª–∏ –≤–æ–ø—Ä–æ—Å" required style="resize: vertical; min-height: 120px;"></textarea>
                        </div>
                        <button type="submit" class="btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é -->
        <div class="bottom-nav">
            <div class="bottom-nav-corner-right"></div>
            <div class="nav-item active" onclick="showPage('lessons')">
                <div class="nav-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="nav-label">–í–∏–¥–µ–æ —É—Ä–æ–∫–∏</div>
            </div>
            <div class="nav-item" onclick="showPage('strategies')">
                <div class="nav-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
                        <circle cx="12" cy="12" r="6" stroke="currentColor" stroke-width="2" fill="none"/>
                        <circle cx="12" cy="12" r="2" fill="currentColor"/>
                        <path d="M12 2l2 4-2-1-2 1z" fill="currentColor"/>
                        <rect x="11.5" y="6" width="1" height="6" fill="currentColor"/>
                        <path d="M10 14l2-1 2 1v2l-2-1-2 1z" fill="currentColor"/>
                        <path d="M10.5 15.5l1-0.5 1 0.5v1l-1-0.5-1 0.5z" fill="currentColor"/>
                    </svg>
                </div>
                <div class="nav-label">–°—Ç—Ä–∞—Ç–µ–≥–∏–∏</div>
            </div>
            <div class="nav-item" onclick="showPage('family')">
                <div class="nav-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2M4 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2m5 0c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2" stroke="currentColor" stroke-width="1"/>
                        <path d="M12.5 11H17v6c0 .55-.45 1-1 1h-2c-.55 0-1-.45-1-1v-6M11.5 11H7v6c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-6M14 9h-4c-.83 0-1.5.67-1.5 1.5v.5h7v-.5c0-.83-.67-1.5-1.5-1.5" fill="currentColor"/>
                    </svg>
                </div>
                <div class="nav-label">–ù–∞—à–∞ —Å–µ–º—å—è</div>
            </div>
            <div class="nav-item" onclick="showPage('news')">
                <div class="nav-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
                        <line x1="9" y1="9" x2="9.01" y2="9"/>
                        <line x1="15" y1="9" x2="15.01" y2="9"/>
                    </svg>
                </div>
                <div class="nav-label">–ù–æ–≤–æ—Å—Ç–∏</div>
            </div>
            <div class="nav-item" onclick="showPage('analytics')">
                <div class="nav-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <rect x="2" y="3" width="6" height="8" rx="1" stroke="currentColor" stroke-width="2" fill="none"/>
                        <rect x="3" y="5" width="4" height="1" fill="currentColor"/>
                        <rect x="3" y="7" width="2" height="1" fill="currentColor"/>
                        <rect x="3" y="8" width="2" height="1" fill="currentColor"/>
                        <rect x="6" y="8" width="1" height="1" fill="currentColor"/>
                        <circle cx="16" cy="8" r="6" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M16 5v3l2 2" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M12 16l2-2" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                </div>
                <div class="nav-label">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
            </div>
            <div class="nav-item" onclick="showPage('support')">
                <div class="nav-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M12 7v5l3 3" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M16 2v2M8 2v2M20 8h-2M6 8H4M20 16h-2M6 16H4" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                </div>
                <div class="nav-label">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram?.WebApp || {
            ready: () => {},
            expand: () => {},
            sendData: (data) => console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:', data),
            showAlert: (message) => alert(message)
        };

        tg.ready();
        tg.expand();

        let userProfile = null;
        let currentPage = 'lessons';
        let navigationStack = [];
        let currentCoin = 'BTCUSDT';
        let currentChartType = 'candles';
        let currentLanguage = 'ru';
        let strategyManager = null;

        // –†–µ–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        class MarketDataManager {
            constructor() {
                this.ws = null;
                this.candles = [];
                this.currentSymbol = 'BTCUSDT';
                this.callbacks = [];
                this.isConnected = false;
                this.tickerWs = null;
                this.swingPoints = [];
            } 

            async loadHistoricalData(symbol = this.currentSymbol, limit = 500) {
                try {
                    const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=15m&limit=${limit}`;
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    this.candles = data.map(kline => ({
                        time: kline[0],
                        open: parseFloat(kline[1]),
                        high: parseFloat(kline[2]),
                        low: parseFloat(kline[3]),
                        close: parseFloat(kline[4]),
                        volume: parseFloat(kline[5])
                    }));

                    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${this.candles.length} —Å–≤–µ—á–µ–π –¥–ª—è ${symbol}`);
                    this.notifyCallbacks('historicalData', this.candles);
                    return this.candles;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                    return [];
                }
            }

            connectTickerWebSocket() {
                if (this.tickerWs) this.tickerWs.close();

                const symbols = ['btcusdt', 'ethusdt', 'bnbusdt', 'solusdt', 'xrpusdt', 'adausdt'];
                const streams = symbols.map(s => `${s}@ticker`).join('/');
                const wsUrl = `wss://stream.binance.com:9443/stream?streams=${streams}`;
                
                this.tickerWs = new WebSocket(wsUrl);
                
                this.tickerWs.onopen = () => {
                    console.log('Ticker WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω');
                };
                
                this.tickerWs.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        if (data.data) {
                            this.updateTickerUI(data.data);
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ Ticker WebSocket:', error);
                    }
                };
                
                this.tickerWs.onclose = () => {
                    console.log('Ticker WebSocket –æ—Ç–∫–ª—é—á–µ–Ω');
                    setTimeout(() => this.connectTickerWebSocket(), 5000);
                };
            }

            updateTickerUI(ticker) {
                const symbol = ticker.s.toLowerCase();
                const price = parseFloat(ticker.c);
                const change = parseFloat(ticker.P);
                
                const coinMap = {
                    'btcusdt': 'btc',
                    'ethusdt': 'eth', 
                    'bnbusdt': 'bnb',
                    'solusdt': 'sol',
                    'xrpusdt': 'xrp',
                    'adausdt': 'ada'
                };
                
                const coinPrefix = coinMap[symbol];
                if (!coinPrefix) return;
                
                const priceElement = document.getElementById(`${coinPrefix}Price`);
                const changeElement = document.getElementById(`${coinPrefix}Change`);
                
                if (priceElement) {
                    priceElement.textContent = `${price.toFixed(price >= 1 ? 2 : 4)}`;
                }
                
                if (changeElement) {
                    changeElement.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
                    changeElement.className = `crypto-change ${change >= 0 ? '' : 'negative'}`;
                }
            }

            // –ü–æ–∏—Å–∫ swing —Ç–æ—á–µ–∫ (—ç–∫—Å—Ç—Ä–µ–º—É–º–æ–≤)
            findSwingPoints(lookback = 3) {
                if (this.candles.length < lookback * 2 + 1) return [];
                
                const swings = [];
                
                for (let i = lookback; i < this.candles.length - lookback; i++) {
                    const candle = this.candles[i];
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ swing high
                    let isSwingHigh = true;
                    for (let j = i - lookback; j <= i + lookback; j++) {
                        if (j !== i && this.candles[j].high >= candle.high) {
                            isSwingHigh = false;
                            break;
                        }
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ swing low
                    let isSwingLow = true;
                    for (let j = i - lookback; j <= i + lookback; j++) {
                        if (j !== i && this.candles[j].low <= candle.low) {
                            isSwingLow = false;
                            break;
                        }
                    }
                    
                    if (isSwingHigh) {
                        swings.push({
                            index: i,
                            time: candle.time,
                            price: candle.high,
                            type: 'high'
                        });
                    }
                    
                    if (isSwingLow) {
                        swings.push({
                            index: i,
                            time: candle.time,
                            price: candle.low,
                            type: 'low'
                        });
                    }
                }
                
                this.swingPoints = swings;
                return swings;
            }

            subscribe(callback) {
                this.callbacks.push(callback);
            }
            
            notifyCallbacks(type, data) {
                this.callbacks.forEach(callback => {
                    try {
                        callback(type, data);
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –≤ callback:', error);
                    }
                });
            }

            setSymbol(symbol) {
                this.currentSymbol = symbol;
                this.candles = [];
                this.swingPoints = [];
                this.loadHistoricalData();
            }
        }

// –ú–µ–Ω–µ–¥–∂–µ—Ä Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        class NotificationManager { 
            constructor() {
                this.permission = 'default';
                this.checkPermission();
            }

            async checkPermission() {
                if ('Notification' in window) {
                    this.permission = Notification.permission;
                }
            }

            async requestPermission() {
                if (!('Notification' in window)) {
                    console.log('–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è');
                    return false;
                }

                if (Notification.permission === 'granted') {
                    return true;
                }

                if (Notification.permission !== 'denied') {
                    const permission = await Notification.requestPermission();
                    this.permission = permission;
                    return permission === 'granted';
                }

                return false;
            }

            async showNotification(signal) {
                const hasPermission = await this.requestPermission();
                if (!hasPermission) {
                    console.log('–ù–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è');
                    return;
                }

                const signalEmoji = {
                    'BUY': 'üü¢',
                    'SELL': 'üî¥',
                    'NEUTRAL': '‚ö™',
                    'HOLD': 'üü°',
                    'TOUCH': 'üîµ',
                    'BREAKOUT': 'üöÄ',
                    'BREAKDOWN': 'üìâ'
                };

                const emoji = signalEmoji[signal.signal] || 'üìä';
                const title = `${emoji} ${signal.symbol} - ${signal.signal}`;
                const body = `${signal.strategy.toUpperCase()}: ${signal.reason}\n–¶–µ–Ω–∞: $${signal.price?.toFixed(2) || 'N/A'}\n–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${signal.confidence}%`;

                if ('serviceWorker' in navigator) {
                    try {
                        const registration = await navigator.serviceWorker.ready;
                        await registration.showNotification(title, {
                            body: body,
                            icon: '/icon-192.png',
                            badge: '/badge-72.png',
                            vibrate: [200, 100, 200],
                            tag: `signal-${signal.id}`,
                            requireInteraction: false,
                            data: {
                                url: '/',
                                signal: signal
                            }
                        });
                        console.log('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:', signal);
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', error);
                    }
                } else {
                    new Notification(title, {
                        body: body,
                        icon: '/icon-192.png',
                        vibrate: [200, 100, 200]
                    });
                }
            }

            async showTestNotification() {
                const testSignal = {
                    id: Date.now(),
                    symbol: 'BTCUSDT',
                    signal: 'BUY',
                    strategy: 'test',
                    reason: '–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ',
                    price: 50000,
                    confidence: 85
                };
                
                await this.showNotification(testSignal);
            }

}  // –ö–æ–Ω–µ—Ü NotificationManager

// ============================================
// üîî –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
// ============================================

// –§—É–Ω–∫—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
async function toggleNotifications() {
    if (!window.notificationManager) {
        const message = '‚ùå –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞';
        if (typeof tg !== 'undefined' && tg.showAlert) {
            tg.showAlert(message);
        } else {
            alert(message);
        }
        return;
    }
    
    const hasPermission = await window.notificationManager.requestPermission();
    
    if (hasPermission) {
        const message = '‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã!\n\n–¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.';
        if (typeof tg !== 'undefined' && tg.showAlert) {
            tg.showAlert(message);
        } else {
            alert(message);
        }
        if (typeof toggleSettingsDropdown === 'function') {
            toggleSettingsDropdown();
        }
    } else {
        const message = '‚ö†Ô∏è –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ.\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞:\n1. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ üîí —Å–ª–µ–≤–∞ –æ—Ç –∞–¥—Ä–µ—Å–∞ —Å–∞–π—Ç–∞\n2. –†–∞–∑—Ä–µ—à–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è';
        if (typeof tg !== 'undefined' && tg.showAlert) {
            tg.showAlert(message);
        } else {
            alert(message);
        }
    }
}

// –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
function testNotification() {
    // ... (—Ç–≤–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥)
}
// –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
function testNotification() {
    if (window.notificationManager) {
        window.notificationManager.showTestNotification();
        const message = 'üß™ –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!';
        if (typeof tg !== 'undefined' && tg.showAlert) {
            tg.showAlert(message);
        } else {
            alert(message);
        }
    } else {
        const message = '‚ùå –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞';
        if (typeof tg !== 'undefined' && tg.showAlert) {
            tg.showAlert(message);
        } else {
            alert(message);
        }
    }
    if (typeof toggleSettingsDropdown === 'function') {
        toggleSettingsDropdown();
    }
}

        


        // –°—Ç—Ä–∞—Ç–µ–≥–∏—è TREND –ø–æ –∞–≤—Ç–æ—Ä—Å–∫–æ–π –ª–æ–≥–∏–∫–µ
        class TRENDStrategy {
            constructor() {
                this.name = 'TREND';
                this.period = 14;
            }

            calculateMA(candles, period = this.period) {
                if (candles.length < period) return [];
                
                const ma = [];
                for (let i = period - 1; i < candles.length; i++) {
                    let sum = 0;
                    for (let j = i - period + 1; j <= i; j++) {
                        sum += candles[j].close;
                    }
                    ma.push({
                        time: candles[i].time,
                        value: sum / period
                    });
                }
                return ma;
            }

            analyze(candles) {
                if (candles.length < this.period + 3) {
                    return {
                        signal: 'WAIT',
                        reason: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞',
                        confidence: 0
                    };
                }

                const ma = this.calculateMA(candles);
                const last3Candles = candles.slice(-3);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ 3 –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–≤–µ—á–∏ –∑–∞–∫—Ä—ã–ª–∏—Å—å –≤—ã—à–µ TREND
                const allAboveMA = last3Candles.every((candle, index) => {
                    const maIndex = ma.length - 3 + index;
                    return maIndex >= 0 && candle.close > ma[maIndex].value;
                });

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ 3 –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–≤–µ—á–∏ –∑–∞–∫—Ä—ã–ª–∏—Å—å –Ω–∏–∂–µ TREND
                const allBelowMA = last3Candles.every((candle, index) => {
                    const maIndex = ma.length - 3 + index;
                    return maIndex >= 0 && candle.close < ma[maIndex].value;
                });

                const currentPrice = candles[candles.length - 1].close;
                const currentMA = ma[ma.length - 1].value;

                if (allAboveMA) {
                    return {
                        signal: 'BUY',
                        reason: '3 —Å–≤–µ—á–∏ –ø–æ–¥—Ä—è–¥ –∑–∞–∫—Ä—ã–ª–∏—Å—å –≤—ã—à–µ TREND',
                        price: currentPrice,
                        ma: currentMA,
                        confidence: 85
                    };
                } else if (allBelowMA) {
                    return {
                        signal: 'SELL',
                        reason: '3 —Å–≤–µ—á–∏ –ø–æ–¥—Ä—è–¥ –∑–∞–∫—Ä—ã–ª–∏—Å—å –Ω–∏–∂–µ TREND',
                        price: currentPrice,
                        ma: currentMA,
                        confidence: 85
                    };
                } else {
                    return {
                        signal: 'NEUTRAL',
                        reason: '–ù–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞',
                        price: currentPrice,
                        ma: currentMA,
                        confidence: 40
                    };
                }
            }
        }

        // –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –ª–∏–Ω–∏–∏ –ø–æ –ª–æ–≥–∏–∫–µ —Ç—Ä–æ–π–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –®–∞—Ö—Ä—É–∑–∞
        class TrendlineStrategy {
            constructor() {
                this.name = 'Trendline';
                this.trendlines = [];
                this.currentPattern = null;
            }

            analyze(candles, swingPoints) {
                if (swingPoints.length < 4) {
                    return {
                        signal: 'WAIT',
                        reason: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ swing —Ç–æ—á–µ–∫ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –ª–∏–Ω–∏–∏',
                        confidence: 0
                    };
                }

                // –ò—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω –≤–æ—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–µ–Ω–¥–∞: 1-–•–∞–π, 2-–õ–æ—É, 3-–ü–µ—Ä–µ—Ö–∞–π, 4-–õ–æ—É
                const ascendingPattern = this.findAscendingPattern(swingPoints);
                if (ascendingPattern) {
                    return this.analyzeAscendingTrendline(candles, ascendingPattern);
                }

                // –ò—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω –Ω–∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–µ–Ω–¥–∞: 1-–õ–æ—É, 2-–•–∞–π, 3-–ü–µ—Ä–µ–ª–æ–≤, 4-–•–∞–π
                const descendingPattern = this.findDescendingPattern(swingPoints);
                if (descendingPattern) {
                    return this.analyzeDescendingTrendline(candles, descendingPattern);
                }

                return {
                    signal: 'NEUTRAL',
                    reason: '–ü–∞—Ç—Ç–µ—Ä–Ω —Ç—Ä–æ–π–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω',
                    confidence: 20
                };
            }

            findAscendingPattern(swingPoints) {
                // –ò—â–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –•–∞–π -> –õ–æ—É -> –ü–µ—Ä–µ—Ö–∞–π -> –õ–æ—É
                for (let i = swingPoints.length - 1; i >= 3; i--) {
                    const point4 = swingPoints[i];
                    if (point4.type !== 'low') continue;

                    for (let j = i - 1; j >= 2; j--) {
                        const point3 = swingPoints[j];
                        if (point3.type !== 'high') continue;

                        for (let k = j - 1; k >= 1; k--) {
                            const point2 = swingPoints[k];
                            if (point2.type !== 'low') continue;

                            for (let l = k - 1; l >= 0; l--) {
                                const point1 = swingPoints[l];
                                if (point1.type !== 'high') continue;

                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ point3 –≤—ã—à–µ point1 (–ø–µ—Ä–µ—Ö–∞–π)
                                if (point3.price > point1.price) {
                                    return { point1, point2, point3, point4 };
                                }
                            }
                        }
                    }
                }
                return null;
            }

            findDescendingPattern(swingPoints) {
                // –ò—â–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –õ–æ—É -> –•–∞–π -> –ü–µ—Ä–µ–ª–æ–≤ -> –•–∞–π
                for (let i = swingPoints.length - 1; i >= 3; i--) {
                    const point4 = swingPoints[i];
                    if (point4.type !== 'high') continue;

                    for (let j = i - 1; j >= 2; j--) {
                        const point3 = swingPoints[j];
                        if (point3.type !== 'low') continue;

                        for (let k = j - 1; k >= 1; k--) {
                            const point2 = swingPoints[k];
                            if (point2.type !== 'high') continue;

                            for (let l = k - 1; l >= 0; l--) {
                                const point1 = swingPoints[l];
                                if (point1.type !== 'low') continue;

                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ point3 –Ω–∏–∂–µ point1 (–ø–µ—Ä–µ–ª–æ–≤)
                                if (point3.price < point1.price) {
                                    return { point1, point2, point3, point4 };
                                }
                            }
                        }
                    }
                }
                return null;
            }

            analyzeAscendingTrendline(candles, pattern) {
                const currentPrice = candles[candles.length - 1].close;
                const trendlinePrice = this.calculateTrendlinePrice(pattern.point2, pattern.point4, candles[candles.length - 1].time);
                
                const distance = Math.abs(currentPrice - trendlinePrice) / trendlinePrice * 100;
                
                if (distance < 0.5) { // –ö–∞—Å–∞–Ω–∏–µ –ª–∏–Ω–∏–∏ (0.5%)
                    return {
                        signal: 'TOUCH',
                        reason: '–ö–∞—Å–∞–Ω–∏–µ –≤–æ—Å—Ö–æ–¥—è—â–µ–π —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –ª–∏–Ω–∏–∏',
                        price: currentPrice,
                        trendlinePrice: trendlinePrice,
                        confidence: 75
                    };
                } else if (currentPrice < trendlinePrice * 0.995) { // –ü—Ä–æ–±–æ–π –≤–Ω–∏–∑
                    return {
                        signal: 'BREAKDOWN',
                        reason: '–ü—Ä–æ–±–æ–π –≤–æ—Å—Ö–æ–¥—è—â–µ–π —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –ª–∏–Ω–∏–∏ –≤–Ω–∏–∑',
                        price: currentPrice,
                        trendlinePrice: trendlinePrice,
                        confidence: 80
                    };
                } else {
                    return {
                        signal: 'HOLD',
                        reason: '–¶–µ–Ω–∞ –≤—ã—à–µ —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –ª–∏–Ω–∏–∏',
                        price: currentPrice,
                        trendlinePrice: trendlinePrice,
                        confidence: 60
                    };
                }
            }

            analyzeDescendingTrendline(candles, pattern) {
                const currentPrice = candles[candles.length - 1].close;
                const trendlinePrice = this.calculateTrendlinePrice(pattern.point2, pattern.point4, candles[candles.length - 1].time);
                
                const distance = Math.abs(currentPrice - trendlinePrice) / trendlinePrice * 100;
                
                if (distance < 0.5) { // –ö–∞—Å–∞–Ω–∏–µ –ª–∏–Ω–∏–∏
                    return {
                        signal: 'TOUCH',
                        reason: '–ö–∞—Å–∞–Ω–∏–µ –Ω–∏—Å—Ö–æ–¥—è—â–µ–π —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –ª–∏–Ω–∏–∏',
                        price: currentPrice,
                        trendlinePrice: trendlinePrice,
                        confidence: 75
                    };
                } else if (currentPrice > trendlinePrice * 1.005) { // –ü—Ä–æ–±–æ–π –≤–≤–µ—Ä—Ö
                    return {
                        signal: 'BREAKOUT',
                        reason: '–ü—Ä–æ–±–æ–π –Ω–∏—Å—Ö–æ–¥—è—â–µ–π —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –ª–∏–Ω–∏–∏ –≤–≤–µ—Ä—Ö',
                        price: currentPrice,
                        trendlinePrice: trendlinePrice,
                        confidence: 80
                    };
                } else {
                    return {
                        signal: 'HOLD',
                        reason: '–¶–µ–Ω–∞ –Ω–∏–∂–µ —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –ª–∏–Ω–∏–∏',
                        price: currentPrice,
                        trendlinePrice: trendlinePrice,
                        confidence: 60
                    };
                }
            }

            calculateTrendlinePrice(point1, point2, currentTime) {
                const timeDiff = point2.time - point1.time;
                const priceDiff = point2.price - point1.price;
                const slope = priceDiff / timeDiff;
                
                return point2.price + slope * (currentTime - point2.time);
            }
        }

        // –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç—Ä–µ–Ω–¥–æ–≤–æ–≥–æ –∫–∞–Ω–∞–ª–∞
        class ChannelStrategy {
            constructor() {
                this.name = 'Channel';
                this.channels = [];
            }

            analyze(candles, swingPoints) {
                if (swingPoints.length < 3) {
                    return {
                        signal: 'WAIT',
                        reason: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ—á–µ–∫ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞',
                        confidence: 0
                    };
                }

                // –ò—â–µ–º –≤–æ—Å—Ö–æ–¥—è—â–∏–π –∫–∞–Ω–∞–ª
                const ascendingChannel = this.findAscendingChannel(swingPoints);
                if (ascendingChannel) {
                    return this.analyzeAscendingChannel(candles, ascendingChannel);
                }

                // –ò—â–µ–º –Ω–∏—Å—Ö–æ–¥—è—â–∏–π –∫–∞–Ω–∞–ª
                const descendingChannel = this.findDescendingChannel(swingPoints);
                if (descendingChannel) {
                    return this.analyzeDescendingChannel(candles, descendingChannel);
                }

                return {
                    signal: 'NEUTRAL',
                    reason: '–¢—Ä–µ–Ω–¥–æ–≤—ã–π –∫–∞–Ω–∞–ª –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω',
                    confidence: 30
                };
            }

            findAscendingChannel(swingPoints) {
                // –ò—â–µ–º 1-–•–∞–π, 2-–õ–æ—É, 3-–ü–µ—Ä–µ—Ö–∞–π
                for (let i = swingPoints.length - 1; i >= 2; i--) {
                    const point3 = swingPoints[i];
                    if (point3.type !== 'high') continue;

                    for (let j = i - 1; j >= 1; j--) {
                        const point2 = swingPoints[j];
                        if (point2.type !== 'low') continue;

                        for (let k = j - 1; k >= 0; k--) {
                            const point1 = swingPoints[k];
                            if (point1.type !== 'high') continue;

                            if (point3.price > point1.price) {
                                return { point1, point2, point3 };
                            }
                        }
                    }
                }
                return null;
            }

            findDescendingChannel(swingPoints) {
                // –ò—â–µ–º 1-–õ–æ—É, 2-–•–∞–π, 3-–ü–µ—Ä–µ–ª–æ–≤
                for (let i = swingPoints.length - 1; i >= 2; i--) {
                    const point3 = swingPoints[i];
                    if (point3.type !== 'low') continue;

                    for (let j = i - 1; j >= 1; j--) {
                        const point2 = swingPoints[j];
                        if (point2.type !== 'high') continue;

                        for (let k = j - 1; k >= 0; k--) {
                            const point1 = swingPoints[k];
                            if (point1.type !== 'low') continue;

                            if (point3.price < point1.price) {
                                return { point1, point2, point3 };
                            }
                        }
                    }
                }
                return null;
            }

            analyzeAscendingChannel(candles, channel) {
                const currentPrice = candles[candles.length - 1].close;
                const currentTime = candles[candles.length - 1].time;
                
                const upperBound = this.calculateChannelPrice(channel.point1, channel.point3, currentTime);
                const lowerBound = this.calculateParallelPrice(channel.point1, channel.point3, channel.point2, currentTime);
                
                const channelWidth = upperBound - lowerBound;
                const pricePosition = (currentPrice - lowerBound) / channelWidth;
                
                if (pricePosition >= 0.9) {
                    return {
                        signal: 'SELL',
                        reason: '–¶–µ–Ω–∞ —É –≤–µ—Ä—Ö–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã –≤–æ—Å—Ö–æ–¥—è—â–µ–≥–æ –∫–∞–Ω–∞–ª–∞',
                        price: currentPrice,
                        upperBound: upperBound,
                        lowerBound: lowerBound,
                        confidence: 70
                    };
                } else if (pricePosition <= 0.1) {
                    return {
                        signal: 'BUY',
                        reason: '–¶–µ–Ω–∞ —É –Ω–∏–∂–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã –≤–æ—Å—Ö–æ–¥—è—â–µ–≥–æ –∫–∞–Ω–∞–ª–∞',
                        price: currentPrice,
                        upperBound: upperBound,
                        lowerBound: lowerBound,
                        confidence: 70
                    };
                } else if (currentPrice > upperBound) {
                    return {
                        signal: 'BREAKOUT',
                        reason: '–ü—Ä–æ–±–æ–π –≤–µ—Ä—Ö–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã –∫–∞–Ω–∞–ª–∞ –≤–≤–µ—Ä—Ö',
                        price: currentPrice,
                        upperBound: upperBound,
                        lowerBound: lowerBound,
                        confidence: 85
                    };
                } else if (currentPrice < lowerBound) {
                    return {
                        signal: 'BREAKDOWN',
                        reason: '–ü—Ä–æ–±–æ–π –Ω–∏–∂–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã –∫–∞–Ω–∞–ª–∞ –≤–Ω–∏–∑',
                        price: currentPrice,
                        upperBound: upperBound,
                        lowerBound: lowerBound,
                        confidence: 85
                    };
                }
                
                return {
                    signal: 'HOLD',
                    reason: '–¶–µ–Ω–∞ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –∫–∞–Ω–∞–ª–∞',
                    price: currentPrice,
                    upperBound: upperBound,
                    lowerBound: lowerBound,
                    confidence: 50
                };
            }

            analyzeDescendingChannel(candles, channel) {
                const currentPrice = candles[candles.length - 1].close;
                const currentTime = candles[candles.length - 1].time;
                
                const lowerBound = this.calculateChannelPrice(channel.point1, channel.point3, currentTime);
                const upperBound = this.calculateParallelPrice(channel.point1, channel.point3, channel.point2, currentTime);
                
                const channelWidth = upperBound - lowerBound;
                const pricePosition = (currentPrice - lowerBound) / channelWidth;
                
                if (pricePosition >= 0.9) {
                    return {
                        signal: 'SELL',
                        reason: '–¶–µ–Ω–∞ —É –≤–µ—Ä—Ö–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã –Ω–∏—Å—Ö–æ–¥—è—â–µ–≥–æ –∫–∞–Ω–∞–ª–∞',
                        price: currentPrice,
                        upperBound: upperBound,
                        lowerBound: lowerBound,
                        confidence: 70
                    };
                } else if (pricePosition <= 0.1) {
                    return {
                        signal: 'BUY',
                        reason: '–¶–µ–Ω–∞ —É –Ω–∏–∂–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã –Ω–∏—Å—Ö–æ–¥—è—â–µ–≥–æ –∫–∞–Ω–∞–ª–∞',
                        price: currentPrice,
                        upperBound: upperBound,
                        lowerBound: lowerBound,
                        confidence: 70
                    };
                } else if (currentPrice > upperBound) {
                    return {
                        signal: 'BREAKOUT',
                        reason: '–ü—Ä–æ–±–æ–π –≤–µ—Ä—Ö–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã –∫–∞–Ω–∞–ª–∞ –≤–≤–µ—Ä—Ö',
                        price: currentPrice,
                        upperBound: upperBound,
                        lowerBound: lowerBound,
                        confidence: 85
                    };
                } else if (currentPrice < lowerBound) {
                    return {
                        signal: 'BREAKDOWN',
                        reason: '–ü—Ä–æ–±–æ–π –Ω–∏–∂–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã –∫–∞–Ω–∞–ª–∞ –≤–Ω–∏–∑',
                        price: currentPrice,
                        upperBound: upperBound,
                        lowerBound: lowerBound,
                        confidence: 85
                    };
                }
                
                return {
                    signal: 'HOLD',
                    reason: '–¶–µ–Ω–∞ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –∫–∞–Ω–∞–ª–∞',
                    price: currentPrice,
                    upperBound: upperBound,
                    lowerBound: lowerBound,
                    confidence: 50
                };
            }

            calculateChannelPrice(point1, point2, currentTime) {
                const timeDiff = point2.time - point1.time;
                const priceDiff = point2.price - point1.price;
                const slope = priceDiff / timeDiff;
                
                return point2.price + slope * (currentTime - point2.time);
            }

            calculateParallelPrice(point1, point2, referencePoint, currentTime) {
                const channelPrice = this.calculateChannelPrice(point1, point2, referencePoint.time);
                const offset = referencePoint.price - channelPrice;
                
                return this.calculateChannelPrice(point1, point2, currentTime) + offset;
            }
        }

        // –ì–ª–∞–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
        class StrategyManager {
            constructor() {
                this.strategies = {
                    TREND: new TRENDStrategy(),
                    trendline: new TrendlineStrategy(),
                    channel: new ChannelStrategy()
                };
                this.signals = [];
                this.marketData = new MarketDataManager();
                this.initializeMarketData();
            }

            initializeMarketData() {
                this.marketData.subscribe((type, data) => {
                    if (type === 'historicalData') {
                        this.analyzeHistoricalData(data);
                    }
                });

                this.marketData.loadHistoricalData().then(() => {
                    this.marketData.connectTickerWebSocket();
                });
            }

            analyzeHistoricalData(candles) {
                // –ù–∞—Ö–æ–¥–∏–º swing —Ç–æ—á–∫–∏
                const swingPoints = this.marketData.findSwingPoints(3);
                
                // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–∂–¥—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
                Object.keys(this.strategies).forEach(strategyName => {
                    const strategy = this.strategies[strategyName];
                    let result;
                    
                    if (strategyName === 'TREND') {
                        result = strategy.analyze(candles);
                    } else {
                        result = strategy.analyze(candles, swingPoints);
                    }
                    
                    this.updateStrategyUI(strategyName, result);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞—á–∏–º—ã–µ —Å–∏–≥–Ω–∞–ª—ã
                    if (['BUY', 'SELL', 'BREAKOUT', 'BREAKDOWN', 'TOUCH'].includes(result.signal)) {
                        this.addSignal(strategyName, result);
                    }
                });
            }

            updateStrategyUI(strategyName, result) {
                const signalElement = document.getElementById(`${strategyName}Signal`);
                if (!signalElement) return;

                signalElement.className = 'signal-indicator';
                
                if (['BUY', 'BREAKOUT'].includes(result.signal)) {
                    signalElement.className += ' signal-buy';
                    signalElement.textContent = `üü¢ ${result.signal} ${result.price?.toFixed(2) || ''}`;
                } else if (['SELL', 'BREAKDOWN'].includes(result.signal)) {
                    signalElement.className += ' signal-sell';
                    signalElement.textContent = `üî¥ ${result.signal} ${result.price?.toFixed(2) || ''}`;
                } else {
                    signalElement.className += ' signal-neutral';
                    signalElement.textContent = `‚ö™ ${result.signal}`;
                }
            }

            addSignal(strategyName, result) {
                const signal = {
                    id: Date.now(),
                    timestamp: Date.now(),
                    symbol: this.marketData.currentSymbol,
                    strategy: strategyName,
                    signal: result.signal,
                    price: result.price,
                    reason: result.reason,
                    confidence: result.confidence || 50
                };

                this.signals.unshift(signal);
                this.signals = this.signals.slice(0, 20); // –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–∏–≥–Ω–∞–ª–æ–≤
                this.updateLiveSignalsUI();
                
// üîî –û–¢–ü–†–ê–í–ö–ê PUSH-–£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
                if (window.notificationManager) {
                    window.notificationManager.showNotification(signal);
                }

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
                if (window.db && window.firestoreUtils) {
                    window.firestoreUtils.addDoc(
                        window.firestoreUtils.collection(window.db, 'signals'), 
                        { ...signal, userId: userProfile?.firstName || 'anonymous' }
                    ).catch(console.error);
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–∏–≥–Ω–∞–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const currentCount = parseInt(localStorage.getItem('userSignalsCount') || '0');
                localStorage.setItem('userSignalsCount', (currentCount + 1).toString());
                updateUserStats();
            }

            updateLiveSignalsUI() {
                const container = document.getElementById('liveSignalsContainer');
                if (!container) return;
                
                const signals = this.signals.slice(0, 5);
                
                if (signals.length === 0) {
                    container.innerHTML = '<div style="color: #b8c5d1; text-align: center; padding: 20px;">–û–∂–∏–¥–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤...</div>';
                    return;
                }

                let signalsHtml = '';
                signals.forEach(signal => {
                    const time = new Date(signal.timestamp).toLocaleTimeString();
                    let signalColor = '#ffbb33';
                    let signalIcon = '‚ö™';
                    
                    if (['BUY', 'BREAKOUT'].includes(signal.signal)) {
                        signalColor = '#00c851';
                        signalIcon = 'üü¢';
                    } else if (['SELL', 'BREAKDOWN'].includes(signal.signal)) {
                        signalColor = '#ff4444';
                        signalIcon = 'üî¥';
                    } else if (signal.signal === 'TOUCH') {
                        signalColor = '#4facfe';
                        signalIcon = 'üîµ';
                    }
                    
                    signalsHtml += `
                        <div class="signal-item" style="--signal-color: ${signalColor};">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <div style="color: ${signalColor}; font-weight: bold;">
                                    ${signalIcon} ${signal.strategy.toUpperCase()}: ${signal.signal}
                                </div>
                                <div style="color: #b8c5d1; font-size: 12px;">${time}</div>
                            </div>
                            <div style="color: #ffffff; font-size: 14px; margin-bottom: 5px;">
                                ${signal.symbol} - ${signal.price.toFixed(2)} (${signal.confidence}%)
                            </div>
                            <div style="color: #b8c5d1; font-size: 12px;">${signal.reason}</div>
                        </div>
                    `;
                });
                
                container.innerHTML = signalsHtml;
            }

            setSymbol(symbol) {
                this.marketData.setSymbol(symbol);
                this.signals = [];
                this.updateLiveSignalsUI();
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –Ω–æ–≤–æ—Å—Ç–µ–π
        function switchNewsSource(source) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–æ–≤–æ—Å—Ç–µ–π
            document.querySelectorAll('.news-container').forEach(container => {
                container.style.display = 'none';
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —Ç–∞–±–æ–≤
            document.querySelectorAll('.news-tab').forEach(tab => {
                tab.style.background = 'rgba(255, 255, 255, 0.1)';
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫
            document.getElementById(source + '-news').style.display = 'block';
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
            document.getElementById(source + '-tab').style.background = 'linear-gradient(45deg, #4facfe 0%, #00f2fe 100%)';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞
            if (source === 'marketwatch') {
                loadMarketWatchNews();
            } else if (source === 'api') {
                loadAPINews();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π MarketWatch —á–µ—Ä–µ–∑ RSS
        async function loadMarketWatchNews() {
            const container = document.getElementById('marketwatch-content');
            
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º RSS2JSON API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è RSS MarketWatch
                const response = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https://feeds.marketwatch.com/marketwatch/topstories/');
                const data = await response.json();
                
                if (data.status === 'ok' && data.items) {
                    let newsHtml = '';
                    data.items.slice(0, 10).forEach(item => {
                        const date = new Date(item.pubDate).toLocaleDateString('ru-RU');
                        newsHtml += `
                            <div class="news-item" style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                <h3 style="color: #4facfe; margin-bottom: 10px; font-size: 16px; line-height: 1.4;">${item.title}</h3>
                                <p style="color: #b8c5d1; font-size: 14px; line-height: 1.5; margin-bottom: 10px;">${item.description.replace(/<[^>]*>/g, '').substring(0, 200)}...</p>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="color: #4facfe; font-size: 12px;">${date}</span>
                                    <a href="${item.link}" target="_blank" style="color: #00f2fe; text-decoration: none; font-size: 12px; border: 1px solid #00f2fe; padding: 5px 10px; border-radius: 5px;">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ</a>
                                </div>
                            </div>
                        `;
                    });
                    container.innerHTML = newsHtml;
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ RSS');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ MarketWatch:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #b8c5d1;">
                        <div style="font-size: 48px; margin-bottom: 20px;">‚ö†Ô∏è</div>
                        <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π MarketWatch</p>
                        <button onclick="loadMarketWatchNews()" style="margin-top: 15px; padding: 10px 20px; background: #4facfe; border: none; border-radius: 5px; color: white; cursor: pointer;">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                    </div>
                `;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ API
        async function loadAPINews() {
            const container = document.getElementById('api-news-content');
            
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º NewsAPI (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ)
                const apiKey = 'YOUR_API_KEY'; // –ù—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω–∞ newsapi.org
                const response = await fetch(`https://newsapi.org/v2/everything?q=cryptocurrency OR bitcoin OR ethereum&language=en&sortBy=publishedAt&pageSize=20&apiKey=${apiKey}`);
                
                if (!response.ok) {
                    throw new Error('API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                const data = await response.json();
                
                if (data.articles && data.articles.length > 0) {
                    let newsHtml = '';
                    data.articles.slice(0, 15).forEach(article => {
                        if (article.title && article.description) {
                            const date = new Date(article.publishedAt).toLocaleDateString('ru-RU');
                            const time = new Date(article.publishedAt).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'});
                            
                            newsHtml += `
                                <div class="news-item" style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <h3 style="color: #4facfe; margin-bottom: 10px; font-size: 16px; line-height: 1.4;">${article.title}</h3>
                                    <p style="color: #b8c5d1; font-size: 14px; line-height: 1.5; margin-bottom: 10px;">${article.description ? article.description.substring(0, 200) : ''}...</p>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <span style="color: #00f2fe; font-size: 12px; margin-right: 10px;">${article.source.name}</span>
                                            <span style="color: #4facfe; font-size: 12px;">${date} ${time}</span>
                                        </div>
                                        <a href="${article.url}" target="_blank" style="color: #00f2fe; text-decoration: none; font-size: 12px; border: 1px solid #00f2fe; padding: 5px 10px; border-radius: 5px;">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ</a>
                                    </div>
                                </div>
                            `;
                        }
                    });
                    container.innerHTML = newsHtml;
                } else {
                    throw new Error('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ API –Ω–æ–≤–æ—Å—Ç–µ–π:', error);
                // Fallback –∫ –¥–µ–º–æ –Ω–æ–≤–æ—Å—Ç—è–º
                loadDemoNews();
            }
        }

        // –î–µ–º–æ –Ω–æ–≤–æ—Å—Ç–∏ –∫–∞–∫ fallback
        function loadDemoNews() {
            const container = document.getElementById('api-news-content');
            const demoNews = [
                {
                    title: "Bitcoin –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –Ω–æ–≤—ã—Ö –≤—ã—Å–æ—Ç –Ω–∞ —Ñ–æ–Ω–µ –∏–Ω—Å—Ç–∏—Ç—É—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞",
                    description: "–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã–π —Ä—ã–Ω–æ–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç, –ø–æ—Å–∫–æ–ª—å–∫—É –∫—Ä—É–ø–Ω—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–æ–Ω–¥—ã —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç —Å–≤–æ–∏ –ø–æ–∑–∏—Ü–∏–∏ –≤ Bitcoin.",
                    source: "CryptoNews",
                    date: new Date().toLocaleDateString('ru-RU'),
                    time: new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'}),
                    url: "#"
                },
                {
                    title: "Ethereum –≥–æ—Ç–æ–≤–∏—Ç—Å—è –∫ –∫—Ä—É–ø–Ω–æ–º—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é –ø—Ä–æ—Ç–æ–∫–æ–ª–∞",
                    description: "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–Ω–æ–Ω—Å–∏—Ä–æ–≤–∞–ª–∏ –≤–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã —É–ª—É—á—à–∏—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ —Å–Ω–∏–∑–∏—Ç—å –∫–æ–º–∏—Å—Å–∏–∏.",
                    source: "EthereumWorld", 
                    date: new Date(Date.now() - 2*60*60*1000).toLocaleDateString('ru-RU'),
                    time: new Date(Date.now() - 2*60*60*1000).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'}),
                    url: "#"
                },
                {
                    title: "–†–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç: –Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –±–∏—Ä–∂",
                    description: "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–≥—É–ª—è—Ç–æ—Ä—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º.",
                    source: "FinanceToday",
                    date: new Date(Date.now() - 4*60*60*1000).toLocaleDateString('ru-RU'), 
                    time: new Date(Date.now() - 4*60*60*1000).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'}),
                    url: "#"
                }
            ];
            
            let newsHtml = '';
            demoNews.forEach(article => {
                newsHtml += `
                    <div class="news-item" style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                        <h3 style="color: #4facfe; margin-bottom: 10px; font-size: 16px; line-height: 1.4;">${article.title}</h3>
                        <p style="color: #b8c5d1; font-size: 14px; line-height: 1.5; margin-bottom: 10px;">${article.description}</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <span style="color: #00f2fe; font-size: 12px; margin-right: 10px;">${article.source}</span>
                                <span style="color: #4facfe; font-size: 12px;">${article.date} ${article.time}</span>
                            </div>
                            <span style="color: #ffbb33; font-size: 12px; border: 1px solid #ffbb33; padding: 5px 10px; border-radius: 5px;">DEMO</span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = newsHtml;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è)
        async function loadRealNews() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º MarketWatch –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            setTimeout(() => {
                loadMarketWatchNews();
            }, 1000);
        }

        function loadMockNews() {
            const newsContainer = document.getElementById('newsContainer');
            if (!newsContainer) return;
            
            const mockNews = [
                {
                    title: "Bitcoin –¥–æ—Å—Ç–∏–≥ –Ω–æ–≤–æ–≥–æ –º–∞–∫—Å–∏–º—É–º–∞ –≤ $67,000",
                    description: "–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã–π —Ä—ã–Ω–æ–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç –Ω–∞ —Ñ–æ–Ω–µ –∏–Ω—Å—Ç–∏—Ç—É—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∫ —Ü–∏—Ñ—Ä–æ–≤—ã–º –∞–∫—Ç–∏–≤–∞–º.",
                    created_at: new Date().toISOString(),
                    url: "#"
                },
                {
                    title: "Ethereum –≥–æ—Ç–æ–≤–∏—Ç—Å—è –∫ –∫—Ä—É–ø–Ω–æ–º—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é —Å–µ—Ç–∏",
                    description: "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ Ethereum –æ–±—ä—è–≤–∏–ª–∏ –æ –ø–ª–∞–Ω–∞—Ö –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –∫–≤–∞—Ä—Ç–∞–ª–µ.",
                    created_at: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                    url: "#"
                },
                {
                    title: "–ù–æ–≤—ã–µ —Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –∫—Ä–∏–ø—Ç–æ–±–∏—Ä–∂",
                    description: "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–≥—É–ª—è—Ç–æ—Ä—ã —É–∂–µ—Å—Ç–æ—á–∞—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã–º –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º –¥–ª—è –∑–∞—â–∏—Ç—ã –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤.",
                    created_at: new Date(Date.now() - 4 * 60 * 60 * 1000).toISOString(),
                    url: "#"
                },
                {
                    title: "DeFi –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–µ–∫–æ—Ä–¥–Ω—ã–π —Ä–æ—Å—Ç",
                    description: "–û–±—â–∞—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ DeFi –ø—Ä–æ—Ç–æ–∫–æ–ª–∞—Ö –ø—Ä–µ–≤—ã—Å–∏–ª–∞ $100 –º–∏–ª–ª–∏–∞—Ä–¥–æ–≤.",
                    created_at: new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString(),
                    url: "#"
                }
            ];
            
            displayNews(mockNews);
        }

        function displayNews(newsArray) {
            const newsContainer = document.getElementById('newsContainer');
            if (!newsContainer) return;
            
            newsContainer.innerHTML = '';
            
            if (newsArray.length === 0) {
                newsContainer.innerHTML = '<div class="loading">–ù–æ–≤–æ—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }
            
            newsArray.forEach(news => {
                const newsItem = document.createElement('div');
                newsItem.className = 'news-item';
                
                const date = new Date(news.created_at || news.date);
                const formattedDate = date.toLocaleDateString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                newsItem.innerHTML = `
                    <div class="news-title">${news.title}</div>
                    <div class="news-summary">${news.description || news.summary}</div>
                    <div class="news-date">${formattedDate}</div>
                `;
                
                if (news.url && news.url !== '#') {
                    newsItem.style.cursor = 'pointer';
                    newsItem.addEventListener('click', () => {
                        window.open(news.url, '_blank');
                    });
                }
                
                newsContainer.appendChild(newsItem);
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ —á–∞—Å—Ç–∏—Ü –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function initParticles() {
            const particlesContainer = document.getElementById('particles-js');
            if (!particlesContainer) return;

            // –°–æ–∑–¥–∞–µ–º —á–∞—Å—Ç–∏—Ü—ã –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 3 + 1;
                const startX = Math.random() * 100;
                const startY = Math.random() * 100;
                const endX = startX + (Math.random() - 0.5) * 200;
                const endY = startY + (Math.random() - 0.5) * 200;
                const duration = Math.random() * 10 + 5;
                const delay = Math.random() * 5;
                
                particle.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    background: rgba(79, 172, 254, ${Math.random() * 0.8 + 0.2});
                    border-radius: 50%;
                    left: ${startX}%;
                    top: ${startY}%;
                    --dx: ${endX - startX}%;
                    --dy: ${endY - startY}%;
                    animation: particleFloat ${duration}s linear infinite;
                    animation-delay: ${delay}s;
                `;
                
                particlesContainer.appendChild(particle);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function checkAuth() {
            const savedProfile = JSON.parse(localStorage.getItem('userProfile') || 'null');
            if (savedProfile) {
                userProfile = savedProfile;
                showMainApp();
                setTimeout(initializeApp, 1000);
            }
        }

        function showMainApp() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            updateUserInterface();
        }

        function updateUserInterface() {
            if (userProfile) {
                const supportNameInput = document.getElementById('supportName');
                if (supportNameInput) {
                    supportNameInput.value = `${userProfile.firstName} ${userProfile.lastName}`;
                }
                updateUserStats();
            }
        }

        function updateUserStats() {
            if (!userProfile) return;
            
            const registrationDate = new Date(userProfile.timestamp);
            const today = new Date();
            const diffDays = Math.ceil(Math.abs(today - registrationDate) / (1000 * 60 * 60 * 24));
            
            const elements = {
                daysInSystemCount: diffDays,
                strategiesUsedCount: localStorage.getItem('strategiesUsedCount') || '0',
                userSignalsCount: localStorage.getItem('userSignalsCount') || '0'
            };
            
            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });
        }

        function initializeApp() {
            strategyManager = new StrategyManager();
            loadRealNews();
        }

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            window.notificationManager = new NotificationManager();
            
            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
            setTimeout(async () => {
                const hasPermission = await window.notificationManager.requestPermission();
                if (hasPermission) {
                    console.log('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω—ã');
                } else {
                    console.log('‚ö†Ô∏è –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã');
                }
            }, 2000);

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        document.getElementById('authForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                birthYear: parseInt(document.getElementById('birthYear').value),
                experience: document.getElementById('experience').value,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('userProfile', JSON.stringify(formData));
            userProfile = formData;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
            if (window.db && window.firestoreUtils) {
                try {
                    await window.firestoreUtils.addDoc(
                        window.firestoreUtils.collection(window.db, 'users'), 
                        { ...formData, createdAt: new Date(), premium: false }
                    );
                } catch (error) {
                    console.error('Firebase error:', error);
                }
            }
            
            tg.sendData(JSON.stringify(formData));
            showMainApp();
            setTimeout(initializeApp, 1000);
        });

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
        function showPage(pageName) {
            if (pageName !== currentPage) {
                navigationStack.push(currentPage);
            }
            
            currentPage = pageName;

            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            document.getElementById(pageName + 'Page').classList.add('active');

            const navItems = document.querySelectorAll('.nav-item');
            const pageIndex = ['lessons', 'strategies', 'family', 'news', 'analytics', 'support'].indexOf(pageName);
            if (pageIndex !== -1 && navItems[pageIndex]) {
                navItems[pageIndex].classList.add('active');
            }

            updateBackButton();

            if (pageName === 'strategies') {
                setTimeout(() => {
                    initTradingViewChart('mainChart');
                }, 100);
            } else if (pageName === 'family') {
                updateFamilyInfo();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ–º—å–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
        function updateFamilyInfo() {
            if (!userProfile) return;
            
            const experienceMap = {
                'beginner': '–ù–æ–≤–∏—á–æ–∫',
                'intermediate': '–°—Ä–µ–¥–Ω–∏–π',
                'advanced': '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π',
                'expert': '–≠–∫—Å–ø–µ—Ä—Ç'
            };
            
            const userName = document.getElementById('familyUserName');
            const userExp = document.getElementById('familyUserExp');
            
            if (userName) {
                userName.textContent = `${userProfile.firstName} ${userProfile.lastName}`;
            }
            
            if (userExp) {
                const exp = experienceMap[userProfile.experience] || '–ù–æ–≤–∏—á–æ–∫';
                const points = localStorage.getItem('userSignalsCount') || '0';
                userExp.textContent = `${exp} ‚Ä¢ ${points} –æ—á–∫–æ–≤`;
            }
        }





        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥—Ä—É–≥–∞
        function inviteFriend() {
            const inviteLink = `https://t.me/TersaaMtBot?start=${userProfile?.firstName || 'user'}_invite`;
            const message = `üöÄ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ TersaaMt!\n\n–¢–æ—Ä–≥–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ Binance –ø–æ –∞–≤—Ç–æ—Ä—Å–∫–æ–π –º–µ—Ç–æ–¥–∏–∫–µ –®–∞—Ö—Ä—É–∑–∞.\n\n${inviteLink}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'TersaaMt - –¢–æ—Ä–≥–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏',
                    text: message,
                    url: inviteLink
                });
            } else {
                navigator.clipboard.writeText(message).then(() => {
                    tg.showAlert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                }).catch(() => {
                    tg.showAlert(`–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π:\n${inviteLink}`);
                });
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TradingView –≥—Ä–∞—Ñ–∏–∫–∞
        function initTradingViewChart(containerId) {
            if (typeof TradingView !== 'undefined') {
                const chartStyle = currentChartType === 'candles' ? "1" : "8";
                
                new TradingView.widget({
                    "width": "100%",
                    "height": 500,
                    "symbol": `BINANCE:${currentCoin}`,
                    "interval": "15",
                    "timezone": "Asia/Tashkent",
                    "theme": "dark",
                    "style": chartStyle,
                    "locale": currentLanguage,
                    "toolbar_bg": "#0a0e27",
                    "enable_publishing": false,
                    "withdateranges": true,
                    "range": "3D",
                    "hide_side_toolbar": false,
                    "allow_symbol_change": true,
                    "details": true,
                    "hotlist": true,
                    "calendar": true,
                    "studies": [
                        "MASimple@tv-basicstudies"
                    ],
                    "container_id": containerId,
                    "studies_overrides": {
                        "MASimple.length": 14,
                        "MASimple.plot.color": "#00c851"
                    },
                    "overrides": {
                        "paneProperties.background": "#0a0e27",
                        "paneProperties.vertGridProperties.color": "#2a2f4a",
                        "paneProperties.horzGridProperties.color": "#2a2f4a",
                        "symbolWatermarkProperties.transparency": 90,
                        "scalesProperties.textColor": "#ffffff",
                        "mainSeriesProperties.candleStyle.upColor": "#00c851",
                        "mainSeriesProperties.candleStyle.downColor": "#ff4444",
                        "mainSeriesProperties.candleStyle.drawWick": true,
                        "mainSeriesProperties.candleStyle.drawBorder": true,
                        "mainSeriesProperties.candleStyle.borderColor": "#378658",
                        "mainSeriesProperties.candleStyle.borderUpColor": "#00c851",
                        "mainSeriesProperties.candleStyle.borderDownColor": "#ff4444",
                        "mainSeriesProperties.candleStyle.wickUpColor": "#00c851",
                        "mainSeriesProperties.candleStyle.wickDownColor": "#ff4444",
                        "mainSeriesProperties.barStyle.upColor": "#00c851",
                        "mainSeriesProperties.barStyle.downColor": "#ff4444"
                    }
                });
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–Ω–µ—Ç–∞–º–∏
        function selectCoin(symbol) {
            currentCoin = symbol;
            
            document.querySelectorAll('.coin-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeCoin = document.querySelector(`[data-coin="${symbol}"]`);
            if (activeCoin) activeCoin.classList.add('active');
            
            if (strategyManager) {
                strategyManager.setSymbol(symbol);
            }
            
            setTimeout(() => {
                initTradingViewChart('mainChart');
            }, 100);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Ñ–∏–ª–µ–º
        function showProfile() {
            if (!userProfile) {
                tg.showAlert('–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }
            
            const experienceMap = {
                'beginner': '–ù–æ–≤–∏—á–æ–∫ (0-6 –º–µ—Å—è—Ü–µ–≤)',
                'intermediate': '–°—Ä–µ–¥–Ω–∏–π (6 –º–µ—Å—è—Ü–µ–≤ - 2 –≥–æ–¥–∞)',
                'advanced': '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π (2-5 –ª–µ—Ç)',
                'expert': '–≠–∫—Å–ø–µ—Ä—Ç (5+ –ª–µ—Ç)'
            };
            
            const registrationDate = new Date(userProfile.timestamp);
            const diffDays = Math.ceil(Math.abs(new Date() - registrationDate) / (1000 * 60 * 60 * 24));
            const hasPremium = localStorage.getItem('premiumAccess') === 'true';
            const strategiesUsed = localStorage.getItem('strategiesUsedCount') || '0';
            const signalsReceived = localStorage.getItem('userSignalsCount') || '0';
            
            const profileText = `üë§ –ü–†–û–§–ò–õ–¨

–ò–º—è: ${userProfile.firstName} ${userProfile.lastName}
–ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è: ${userProfile.birthYear}
–û–ø—ã—Ç: ${experienceMap[userProfile.experience] || userProfile.experience}

üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê
–î–Ω–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ: ${diffDays}
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π: ${strategiesUsed}
–ü–æ–ª—É—á–µ–Ω–æ —Å–∏–≥–Ω–∞–ª–æ–≤: ${signalsReceived}
Premium —Å—Ç–∞—Ç—É—Å: ${hasPremium ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: ${registrationDate.toLocaleDateString('ru-RU')}`;
            
            tg.showAlert(profileText);
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –≤–∏–¥–µ–æ —É—Ä–æ–∫–æ–≤
        function showVideos() {
            tg.showAlert(`üìö –í–ò–î–ï–û –£–†–û–ö–ò

–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –æ–±—É—á–∞—é—â–∏–µ –≤–∏–¥–µ–æ—É—Ä–æ–∫–∏ –ø–æ:

‚Ä¢ –ê–≤—Ç–æ—Ä—Å–∫–æ–π –º–µ—Ç–æ–¥–∏–∫–µ –®–∞—Ö—Ä—É–∑–∞
‚Ä¢ –õ–æ–≥–∏–∫–µ —Ç—Ä–æ–π–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è
‚Ä¢ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏—é —Ç—Ä–µ–Ω–¥–æ–≤—ã—Ö –ª–∏–Ω–∏–π –∏ –∫–∞–Ω–∞–ª–æ–≤
‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ TREND
‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Ä–∏—Å–∫–∞–º–∏ –≤ —Ç–æ—Ä–≥–æ–≤–ª–µ

–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏!`);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function toggleSettingsDropdown() {
            const dropdown = document.getElementById('settingsDropdown');
            if (dropdown) {
                dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
            }
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('selectedLanguage', lang);
            toggleSettingsDropdown();
            tg.showAlert(`–Ø–∑—ã–∫ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: ${lang}`);
        }

        function setChartType(type) {
            currentChartType = type;
            localStorage.setItem('chartType', type);
            if (currentPage === 'strategies') {
                setTimeout(() => {
                    initTradingViewChart('mainChart');
                }, 100);
            }
            tg.showAlert(`–¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: ${type === 'candles' ? '–Ø–ø–æ–Ω—Å–∫–∏–µ —Å–≤–µ—á–∏' : '–ë–∞—Ä—ã'}`);
            toggleSettingsDropdown();
        }

        function activatePromo() {
            const promoInput = document.getElementById('promoInput');
            if (!promoInput) return;
            
            const promoCode = promoInput.value.trim();
            
            if (['TERSAAMT2024', 'SHAHRUZA', 'PREMIUM', 'VIP'].includes(promoCode.toUpperCase())) {
                tg.showAlert('üéâ –ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –í—ã –ø–æ–ª—É—á–∏–ª–∏ –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–µ–º–∏—É–º —Ñ—É–Ω–∫—Ü–∏—è–º!');
                localStorage.setItem('premiumAccess', 'true');
                promoInput.value = '';
            } else if (promoCode === '') {
                tg.showAlert('‚ùå –í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥');
            } else {
                tg.showAlert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥');
            }
            toggleSettingsDropdown();
        }

        function showFAQ() {
            toggleSettingsDropdown();
            tg.showAlert(`‚ùì FAQ:

1. üìà –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏?
   –í—Å–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ –∞–≤—Ç–æ—Ä—Å–∫–æ–π –º–µ—Ç–æ–¥–∏–∫–µ –®–∞—Ö—Ä—É–∑–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ Binance

2. üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ —Ç—Ä–æ–π–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ?
   –ê–≤—Ç–æ—Ä—Å–∫–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤—ã—Ö –ª–∏–Ω–∏–π –∏ –∫–∞–Ω–∞–ª–æ–≤

3. üü¢üî¥ –ß—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç —Å–∏–≥–Ω–∞–ª—ã?
   BUY/SELL - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ TREND
   BREAKOUT/BREAKDOWN - –ø—Ä–æ–±–æ–∏ —Ç—Ä–µ–Ω–¥–æ–≤—ã—Ö –ª–∏–Ω–∏–π/–∫–∞–Ω–∞–ª–æ–≤

4. üéÅ –ö–∞–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥?
   –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –≤–≤–µ–¥–∏—Ç–µ: TERSAAMT2024, SHAHRUZA, PREMIUM, VIP

5. üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞:
   –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ —Ä–∞–∑–¥–µ–ª "–ü–æ–¥–¥–µ—Ä–∂–∫–∞"`);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏
        const supportForm = document.getElementById('supportForm');
        if (supportForm) {
            supportForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const supportData = {
                    name: document.getElementById('supportName').value,
                    subject: document.getElementById('supportSubject').value,
                    description: document.getElementById('supportDescription').value,
                    userProfile: userProfile,
                    timestamp: new Date().toISOString()
                };

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
                try {
                    if (window.db && window.firestoreUtils) {
                        await window.firestoreUtils.addDoc(
                            window.firestoreUtils.collection(window.db, 'support_requests'), 
                            supportData
                        );
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞:', error);
                }

                tg.sendData(JSON.stringify(supportData));
                tg.showAlert('–í–∞—à –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.');
                supportForm.reset();
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                document.getElementById('supportName').value = `${userProfile?.firstName || ''} ${userProfile?.lastName || ''}`.trim();
            });
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ dropdown –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('settingsDropdown');
            const settingsBtn = document.querySelector('.settings-btn');
            
            if (dropdown && settingsBtn && !dropdown.contains(e.target) && !settingsBtn.contains(e.target)) {
                dropdown.style.display = 'none';
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö Telegram WebApp
        if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
            const telegramUser = window.Telegram.WebApp.initDataUnsafe.user;
            
            if (telegramUser.first_name) {
                const firstNameInput = document.getElementById('firstName');
                if (firstNameInput) firstNameInput.value = telegramUser.first_name;
            }
            if (telegramUser.last_name) {
                const lastNameInput = document.getElementById('lastName');
                if (lastNameInput) lastNameInput.value = telegramUser.last_name;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            checkAuth();
            initParticles();
            
            const savedLanguage = localStorage.getItem('selectedLanguage');
            if (savedLanguage) {
                currentLanguage = savedLanguage;
            }
            
            const savedChartType = localStorage.getItem('chartType');
            if (savedChartType) {
                currentChartType = savedChartType;
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ TradingView –≥—Ä–∞—Ñ–∏–∫–∞
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const mainChart = document.getElementById('mainChart');
                if (mainChart) {
                    initTradingViewChart('mainChart');
                }
            }, 2000);
        });

        console.log('TersaaMt Trading App v10.0 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –≥–æ—Ç–æ–≤–∞! üöÄ');
    </script>

<script type="module" src="js/dragon-animation.js"></script>

<script type="module" src="js/main.js"></script>

    <!-- Canvas Strategies Script (injected) -->
    <script>
    (function(){
      // State
      let currentStrategy = null;
      let currentSymbol = 'BTCUSDT';
      let currentTimeframe = '15m';
      let candlesData = [];
      let canvas = null, ctx = null;

      const PADDING = { top: 40, right: 100, bottom: 40, left: 10 };

      // Hook strategy cards if present: (cards have onclick=showStrategy('...'))

      // Strategy entry point
      window.showStrategy = function(strategy){
        currentStrategy = strategy;
        const titles = { TREND:'TREND (D1 Only)', trendline:'–ü—Ä–æ–±–æ–π —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –ª–∏–Ω–∏–∏', channel:'–¢—Ä–µ–Ω–¥–æ–≤—ã–π –∫–∞–Ω–∞–ª' };
        const pageList = ['lessonsPage','strategiesPage','familyPage','newsPage','analyticsPage','supportPage'];
        pageList.forEach(id => { const el=document.getElementById(id); if (el) el.classList.remove('active'); });
        const detail = document.getElementById('strategyDetail');
        if (detail) detail.classList.add('active');

        const titleEl = document.getElementById('strategyDetailTitle');
        if (titleEl) titleEl.textContent = titles[strategy] || '–°—Ç—Ä–∞—Ç–µ–≥–∏—è';

        // Render controls + canvas inside #strategyDetailContent
        const wrapper = document.getElementById('strategyDetailContent');
        if (wrapper){
          wrapper.innerHTML = `
            <div class="chart-controls">
              <select id="coinSelect" onchange="updateStrategyChart()">
                <option value="BTCUSDT">Bitcoin (BTC/USDT)</option>
                <option value="ETHUSDT">Ethereum (ETH/USDT)</option>
                <option value="BNBUSDT">Binance Coin (BNB/USDT)</option>
                <option value="SOLUSDT">Solana (SOL/USDT)</option>
                <option value="XRPUSDT">XRP (XRP/USDT)</option>
                <option value="ADAUSDT">Cardano (ADA/USDT)</option>
              </select>
              <select id="timeframeSelect" onchange="updateStrategyChart()">
                <option value="15m" selected>15 –º–∏–Ω—É—Ç</option>
                <option value="1h">1 —á–∞—Å</option>
                <option value="4h">4 —á–∞—Å–∞</option>
                <option value="1d">1 –¥–µ–Ω—å (D1)</option>
              </select>
              <button onclick="updateStrategyChart()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
              <div style="margin-left:auto;color:#4facfe;font-size:12px;" id="chartStatus">–ì–æ—Ç–æ–≤</div>
            </div>
            <div id="signalDetailBox" class="signal-detail-box" style="display:none;">
              <h3>–¢–µ–∫—É—â–∏–π —Å–∏–≥–Ω–∞–ª:</h3>
              <div id="signalDetailContent"></div>
            </div>
            <div class="chart-info-bar">
              <span id="priceRange">Range: -</span>
              <span id="candleCount">Candles: -</span>
              <span id="currentPrice">Current: -</span>
            </div>
            <div class="canvas-container"><canvas id="strategyCanvas"></canvas></div>
          `;
        }

        const tfSelect = document.getElementById('timeframeSelect');
        if (tfSelect){
          if (strategy === 'TREND'){ tfSelect.value = '1d'; tfSelect.disabled = true; currentTimeframe = '1d'; }
          else { tfSelect.disabled = false; tfSelect.value = '15m'; currentTimeframe = '15m'; }
        }

        canvas = document.getElementById('strategyCanvas');
        if (canvas){ ctx = canvas.getContext('2d'); resizeCanvas(); }
        updateStrategyChart();
      };

      window.goBackToStrategies = function(){
        const detail = document.getElementById('strategyDetail');
        const strategies = document.getElementById('strategiesPage');
        if (detail) detail.classList.remove('active');
        if (strategies) strategies.classList.add('active');
      };

      function resizeCanvas(){
        if (!canvas) return;
        const rect = canvas.parentElement.getBoundingClientRect();
        canvas.width = (rect.width - 20) || 1180;
        canvas.height = 500;
      }
      window.addEventListener('resize', ()=>{ if (canvas){ resizeCanvas(); if (candlesData.length) drawChart(); } });

      async function updateStrategyChart(){
        const coinSel = document.getElementById('coinSelect');
        const tfSel = document.getElementById('timeframeSelect');
        if (coinSel) currentSymbol = coinSel.value;
        if (tfSel) currentTimeframe = tfSel.value;
        if (currentStrategy === 'TREND') currentTimeframe = '1d';

        const limit = currentStrategy === 'TREND' ? 60 : 300;
        setStatus('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
        candlesData = await fetchData(currentSymbol, currentTimeframe, limit);
        if (!candlesData.length){ setStatus('‚úó –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏'); return; }
        drawChart();
        const res = analyzeStrategy(candlesData, currentStrategy);
        displaySignalDetail(res);
        setStatus('‚úì –ì–æ—Ç–æ–≤–æ');
      }
      window.updateStrategyChart = updateStrategyChart;

      function setStatus(msg){
        const s = document.getElementById('chartStatus'); if (s) s.textContent = msg;
      }

      async function fetchData(symbol, interval, limit){
        try{
          const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`;
          const res = await fetch(url);
          const data = await res.json();
          return data.map(k => ({ time:k[0], open:+k[1], high:+k[2], low:+k[3], close:+k[4], volume:+k[5] }));
        }catch(e){
          console.error('Fetch error', e);
          return [];
        }
      }

      function drawChart(){
        if (!ctx || !candlesData.length) return;
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = '#0a0e27'; ctx.fillRect(0,0,canvas.width,canvas.height);

        const chartW = canvas.width - PADDING.left - PADDING.right;
        const chartH = canvas.height - PADDING.top - PADDING.bottom;
        const minP = Math.min(...candlesData.map(c=>c.low));
        const maxP = Math.max(...candlesData.map(c=>c.high));
        const range = (maxP - minP) || 1;
        const toX = i => PADDING.left + (i/(candlesData.length-1))*chartW;
        const toY = p => PADDING.top + chartH - ((p - minP)/range)*chartH;

        // info
        const pr = document.getElementById('priceRange');
        const cc = document.getElementById('candleCount');
        const cp = document.getElementById('currentPrice');
        if (pr) pr.textContent = `Range: $${minP.toFixed(2)} - $${maxP.toFixed(2)}`;
        if (cc) cc.textContent = `Candles: ${candlesData.length}`;
        if (cp) cp.textContent = `Current: $${candlesData[candlesData.length-1].close.toFixed(2)}`;

        // grid
        ctx.strokeStyle = 'rgba(255,255,255,0.08)'; ctx.lineWidth=1; ctx.font='11px monospace'; ctx.fillStyle='#6b7280';
        for (let i=0;i<=5;i++){ const y = PADDING.top + (chartH/5)*i; ctx.beginPath(); ctx.moveTo(PADDING.left,y); ctx.lineTo(canvas.width-PADDING.right,y); ctx.stroke(); }

        // candles
        const cw = max(2, (chartW / candlesData.length)*0.7);
        function max(a,b){ return a>b?a:b; }
        candlesData.forEach((c,i)=>{
          const x = toX(i), oY=toY(c.open), cY=toY(c.close), hY=toY(c.high), lY=toY(c.low);
          const green = c.close >= c.open; const color = green ? '#26a69a' : '#ef5350';
          ctx.strokeStyle=color; ctx.beginPath(); ctx.moveTo(x,hY); ctx.lineTo(x,lY); ctx.stroke();
          ctx.fillStyle=color; ctx.fillRect(x-cw/2, Math.min(oY,cY), cw, Math.max(1, Math.abs(cY-oY)));
        });

        if (currentStrategy === 'TREND') drawTREND(toX,toY);
        if (currentStrategy === 'trendline') drawTrendline(toX,toY);
        if (currentStrategy === 'channel') drawChannel(toX,toY);
      }

      function drawTREND(toX,toY){
        if (candlesData.length < 14) return;
        const ma=[]; for (let i=13;i<candlesData.length;i++){ let s=0; for (let j=i-13;j<=i;j++) s+=candlesData[j].close; ma.push({index:i,value:s/14}); }
        ctx.strokeStyle='#00c851'; ctx.lineWidth=3; ctx.beginPath();
        ma.forEach((p,k)=>{ const x=toX(p.index), y=toY(p.value); if(k===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); });
        ctx.stroke();
      }

      function drawTrendline(toX,toY){
        const res = analyzeTrendline(candlesData);
        if (!res.pattern || res.pattern.length<4) return;
        res.pattern.forEach(p=>{ ctx.fillStyle='#ff6b35'; ctx.beginPath(); ctx.arc(toX(p.index), toY(p.price), 6, 0, Math.PI*2); ctx.fill(); });
        const p1 = res.pattern[1], p2 = res.pattern[3];
        ctx.strokeStyle='#ff6b35'; ctx.lineWidth=3; ctx.setLineDash([8,4]); ctx.beginPath();
        ctx.moveTo(toX(p1.index), toY(p1.price)); ctx.lineTo(toX(p2.index), toY(p2.price));
        const slope = (p2.price - p1.price)/(p2.index - p1.index);
        const ext = p2.price + slope * ((candlesData.length-1) - p2.index);
        ctx.lineTo(toX(candlesData.length-1), toY(ext)); ctx.stroke(); ctx.setLineDash([]);
      }

      function drawChannel(toX,toY){
        const res = analyzeChannel(candlesData);
        if (!res.channel || !res.channel.points) return;
        const pts = res.channel.points;
        pts.forEach(p=>{ ctx.fillStyle='#9c27b0'; ctx.beginPath(); ctx.arc(toX(p.index), toY(p.price), 6, 0, Math.PI*2); ctx.fill(); });
        const slope = (pts[2].price - pts[0].price)/(pts[2].index - pts[0].index);
        const offset = pts[1].price - (pts[0].price + slope*(pts[1].index - pts[0].index));
        ctx.strokeStyle='#9c27b0'; ctx.lineWidth=3;

        // upper
        ctx.beginPath();
        ctx.moveTo(toX(pts[0].index), toY(pts[0].price));
        ctx.lineTo(toX(pts[2].index), toY(pts[2].price));
        const upExt = pts[2].price + slope * ((candlesData.length-1) - pts[2].index);
        ctx.lineTo(toX(candlesData.length-1), toY(upExt));
        ctx.stroke();

        // lower (parallel through point 2)
        ctx.beginPath();
        const l1 = pts[0].price + offset; const l3 = pts[2].price + offset; const lExt = upExt + offset;
        ctx.moveTo(toX(pts[0].index), toY(l1)); ctx.lineTo(toX(pts[2].index), toY(l3)); ctx.lineTo(toX(candlesData.length-1), toY(lExt));
        ctx.stroke();
      }

      // --- Analysis ---
      function analyzeStrategy(candles, strategy){
        if (strategy === 'TREND') return analyzeTREND(candles);
        if (strategy === 'trendline') return analyzeTrendline(candles);
        if (strategy === 'channel') return analyzeChannel(candles);
        return { signal:'WAIT', reason:'Unknown' };
      }

      function analyzeTREND(candles){
        if (candles.length < 17) return { signal:'WAIT', reason:'–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö' };
        const ma=[]; for (let i=13;i<candles.length;i++){ let s=0; for (let j=i-13;j<=i;j++) s+=candles[j].close; ma.push(s/14); }
        const l3 = candles.slice(-3);
        const above = l3.every((c,i)=> c.close > ma[ma.length-3+i]);
        const below = l3.every((c,i)=> c.close < ma[ma.length-3+i]);
        const price = candles[candles.length-1].close;
        if (above) return { signal:'BUY', reason:'3 —Å–≤–µ—á–∏ –≤—ã—à–µ TREND', price, confidence:85 };
        if (below) return { signal:'SELL', reason:'3 —Å–≤–µ—á–∏ –Ω–∏–∂–µ TREND', price, confidence:85 };
        return { signal:'NEUTRAL', reason:'–ù–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è', price, confidence:40 };
      }

      function findSwingPoints(candles, lookback=5){
        const swings=[];
        for (let i=lookback;i<candles.length-lookback;i++){
          let isHigh=true, isLow=true;
          for (let j=i-lookback;j<=i+lookback;j++){
            if (j===i) continue;
            if (candles[j].high >= candles[i].high) isHigh=false;
            if (candles[j].low  <= candles[i].low ) isLow=false;
            if (!isHigh && !isLow) break;
          }
          if (isHigh) swings.push({ index:i, price:candles[i].high, type:'high' });
          if (isLow ) swings.push({ index:i, price:candles[i].low , type:'low'  });
        }
        return swings;
      }

      function analyzeTrendline(candles){
        const swings = findSwingPoints(candles);
        if (swings.length < 4) return { signal:'WAIT', reason:'–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ swing —Ç–æ—á–µ–∫' };
        for (let i=swings.length-1;i>=3;i--){
          if (swings[i].type!=='low') continue;
          for (let j=i-1;j>=2;j--){
            if (swings[j].type!=='high') continue;
            for (let k=j-1;k>=1;k--){
              if (swings[k].type!=='low') continue;
              for (let l=k-1;l>=0;l--){
                if (swings[l].type!=='high') continue;
                if (swings[j].price > swings[l].price){
                  const price = candles[candles.length-1].close;
                  const slope = (swings[i].price - swings[k].price)/(swings[i].index - swings[k].index);
                  const trendPrice = swings[i].price + slope*((candles.length-1) - swings[i].index);
                  const dist = Math.abs(price - trendPrice)/trendPrice*100;
                  const pattern = [swings[l],swings[k],swings[j],swings[i]];
                  if (dist < 1) return { signal:'TOUCH', reason:'–ö–∞—Å–∞–Ω–∏–µ –ª–∏–Ω–∏–∏', price, confidence:75, pattern };
                  if (price < trendPrice*0.995) return { signal:'BREAKDOWN', reason:'–ü—Ä–æ–±–æ–π –≤–Ω–∏–∑', price, confidence:80, pattern };
                  return { signal:'HOLD', reason:'–í—ã—à–µ –ª–∏–Ω–∏–∏', price, confidence:60, pattern };
                }
              }
            }
          }
        }
        return { signal:'NEUTRAL', reason:'–ü–∞—Ç—Ç–µ—Ä–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω', confidence:20 };
      }

      function analyzeChannel(candles){
        const swings = findSwingPoints(candles);
        if (swings.length < 3) return { signal:'WAIT', reason:'–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ—á–µ–∫' };
        for (let i=swings.length-1;i>=2;i--){
          if (swings[i].type!=='high') continue;
          for (let j=i-1;j>=1;j--){
            if (swings[j].type!=='low') continue;
            for (let k=j-1;k>=0;k--){
              if (swings[k].type!=='high') continue;
              if (swings[i].price > swings[k].price){
                const price = candles[candles.length-1].close;
                const slope = (swings[i].price - swings[k].price)/(swings[i].index - swings[k].index);
                const upper = swings[i].price + slope*((candles.length-1) - swings[i].index);
                const mainAtLow = swings[k].price + slope*(swings[j].index - swings[k].index);
                const offset = swings[j].price - mainAtLow;
                const lower = upper + offset;
                const pos = (price - lower)/(upper - lower);
                const channel = { upper, lower, points:[swings[k],swings[j],swings[i]] };
                if (pos >= 0.9) return { signal:'SELL', reason:'–£ –≤–µ—Ä—Ö–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã', price, confidence:70, channel };
                if (pos <= 0.1) return { signal:'BUY', reason:'–£ –Ω–∏–∂–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã', price, confidence:70, channel };
                if (price > upper) return { signal:'BREAKOUT', reason:'–ü—Ä–æ–±–æ–π –≤–≤–µ—Ä—Ö', price, confidence:85, channel };
                if (price < lower) return { signal:'BREAKDOWN', reason:'–ü—Ä–æ–±–æ–π –≤–Ω–∏–∑', price, confidence:85, channel };
                return { signal:'HOLD', reason:'–í–Ω—É—Ç—Ä–∏ –∫–∞–Ω–∞–ª–∞', price, confidence:50, channel };
              }
            }
          }
        }
        return { signal:'NEUTRAL', reason:'–ö–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω', confidence:30 };
      }

      function displaySignalDetail(result){
        const box = document.getElementById('signalDetailBox');
        const content = document.getElementById('signalDetailContent');
        if (!box || !content) return;
        box.style.display = 'block';
        let html = `<div class="signal-badge signal-${result.signal.toLowerCase()}">${result.signal}</div>`;
        html += `<p><strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> ${result.reason || '-'}</p>`;
        if (result.price) html += `<p><strong>–¶–µ–Ω–∞:</strong> $${(+result.price).toFixed(2)}</p>`;
        if (result.confidence) html += `<p><strong>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:</strong> ${result.confidence}%</p>`;
        content.innerHTML = html;
      }
    })();
// =============== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ö–†–ò–ü–¢–û–¢–ò–ö–ï–†–ê ===============
async function updateCryptoTicker() {
    try {
        const symbols = ['BTCUSDT', 'ETHUSDT', 'BNBUSDT', 'SOLUSDT', 'XRPUSDT', 'ADAUSDT'];
        const url = `https://api.binance.com/api/v3/ticker/24hr?symbols=${JSON.stringify(symbols)}`;
        const response = await fetch(url);
        const data = await response.json();
        
        data.forEach(ticker => {
            const symbol = ticker.symbol.toLowerCase().replace('usdt', '');
            const priceEl = document.getElementById(`${symbol}Price`);
            const changeEl = document.getElementById(`${symbol}Change`);
            
            if (priceEl) {
                const price = parseFloat(ticker.lastPrice);
                priceEl.textContent = `$${price >= 1 ? price.toFixed(2) : price.toFixed(4)}`;
            }
            
            if (changeEl) {
                const change = parseFloat(ticker.priceChangePercent);
                changeEl.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
                changeEl.className = `crypto-change ${change >= 0 ? '' : 'negative'}`;
            }
        });
        
        console.log('–¶–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω:', error);
    }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ä–∞–∑—É –∏ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
updateCryptoTicker();
setInterval(updateCryptoTicker, 5000);

// ============== PREMIUM PAYMENT INTEGRATION ==============

const BACKEND_URL = window.location.hostname === 'localhost' 
    ? 'http://localhost:3000' 
    : 'https://your-domain.com';

function showPremiumModal() {
    if (localStorage.getItem('premiumAccess') === 'true') {
        tg.showAlert('–£ –≤–∞—Å —É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω Premium –¥–æ—Å—Ç—É–ø! üéâ');
        return;
    }
    
    const modal = document.getElementById('premiumModal');
    if (modal) {
        modal.classList.add('show');
        modal.style.display = 'flex';
    }
    toggleSettingsDropdown();
}

function closePremiumModal() {
    const modal = document.getElementById('premiumModal');
    if (modal) {
        modal.classList.remove('show');
        setTimeout(() => modal.style.display = 'none', 300);
    }
}

async function initiatePayment() {
    const payButton = document.getElementById('payButton');
    const statusDiv = document.getElementById('paymentStatus');
    
    if (!payButton || !statusDiv) return;
    
    try {
        payButton.disabled = true;
        payButton.textContent = '–°–æ–∑–¥–∞–Ω–∏–µ —Å—á—ë—Ç–∞...';
        statusDiv.classList.add('show');
        statusDiv.textContent = '‚è≥ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –æ–ø–ª–∞—Ç–µ...';
        
        const response = await fetch(`${BACKEND_URL}/api/pay/create`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                amount: 1500000,
                description: 'Premium –¥–æ—Å—Ç—É–ø TersaaMt'
            })
        });
        
        if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—á—ë—Ç–∞');
        
        const data = await response.json();
        if (!data.success) throw new Error(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
        
        localStorage.setItem('pendingOrderId', data.order_id);
        statusDiv.textContent = '‚úÖ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ–ø–ª–∞—Ç—É...';
        
        const paymentWindow = window.open(data.pay_url, '_blank');
        if (!paymentWindow) throw new Error('–†–∞–∑—Ä–µ—à–∏—Ç–µ –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –æ–∫–Ω–∞');
        
        checkPaymentStatus(data.order_id);
        payButton.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ –æ–ø–ª–∞—Ç—ã...';
        statusDiv.textContent = '‚è≥ –û–∂–∏–¥–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã...';
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        statusDiv.textContent = '‚ùå ' + error.message;
        payButton.disabled = false;
        payButton.textContent = '–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞';
    }
}

async function checkPaymentStatus(orderId) {
    const maxAttempts = 60;
    let attempts = 0;
    
    const checkInterval = setInterval(async () => {
        try {
            attempts++;
            const response = await fetch(`${BACKEND_URL}/api/pay/status/${orderId}`);
            const data = await response.json();
            
            if (data.success && data.order.status === 'completed') {
                clearInterval(checkInterval);
                onPaymentSuccess(orderId);
            } else if (data.order.status === 'cancelled') {
                clearInterval(checkInterval);
                onPaymentCancelled();
            } else if (attempts >= maxAttempts) {
                clearInterval(checkInterval);
                onPaymentTimeout();
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:', error);
        }
    }, 5000);
}

function onPaymentSuccess(orderId) {
    const statusDiv = document.getElementById('paymentStatus');
    const payButton = document.getElementById('payButton');
    
    localStorage.setItem('premiumAccess', 'true');
    localStorage.setItem('premiumActivatedAt', new Date().toISOString());
    localStorage.removeItem('pendingOrderId');
    
    if (statusDiv) statusDiv.textContent = 'üéâ Premium —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!';
    if (payButton) {
        payButton.textContent = '–ó–∞–∫—Ä—ã—Ç—å';
        payButton.disabled = false;
        payButton.onclick = () => {
            closePremiumModal();
            tg.showAlert('üéâ Premium –¥–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!\n\n–¢–µ–ø–µ—Ä—å –≤–∞–º –¥–æ—Å—Ç—É–ø–Ω—ã:\n‚úÖ –í—Å–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏\n‚úÖ LIVE —Å–∏–≥–Ω–∞–ª—ã\n‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞');
            updatePremiumFeatures();
        };
    }
}

function onPaymentCancelled() {
    const statusDiv = document.getElementById('paymentStatus');
    const payButton = document.getElementById('payButton');
    
    if (statusDiv) statusDiv.textContent = '‚ùå –ü–ª–∞—Ç–µ–∂ –æ—Ç–º–µ–Ω–µ–Ω';
    if (payButton) {
        payButton.textContent = '–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞';
        payButton.disabled = false;
        payButton.onclick = initiatePayment;
    }
    localStorage.removeItem('pendingOrderId');
}

function onPaymentTimeout() {
    const statusDiv = document.getElementById('paymentStatus');
    const payButton = document.getElementById('payButton');
    
    if (statusDiv) statusDiv.textContent = '‚è±Ô∏è –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ';
    if (payButton) {
        payButton.textContent = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å';
        payButton.disabled = false;
        payButton.onclick = () => {
            const orderId = localStorage.getItem('pendingOrderId');
            if (orderId) checkPaymentStatus(orderId);
        };
    }
}

function updatePremiumFeatures() {
    console.log('‚úÖ Premium features unlocked!');
    if (userProfile) updateUserInterface();
}

function checkPremiumStatus() {
    const hasPremium = localStorage.getItem('premiumAccess') === 'true';
    if (hasPremium) console.log('‚úÖ Premium –¥–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–µ–Ω');
    
    const pendingOrderId = localStorage.getItem('pendingOrderId');
    if (pendingOrderId) setTimeout(() => checkPaymentStatus(pendingOrderId), 1000);
}

window.addEventListener('message', (event) => {
    if (event.data.type === 'PAYMENT_SUCCESS') {
        onPaymentSuccess(event.data.orderId);
    }
});

window.addEventListener('load', checkPremiumStatus);

// ... –≤–µ—Å—å –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

        // ============================================
        // ‚úÖ –°–ò–°–¢–ï–ú–ê –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –°–ò–ì–ù–ê–õ–û–í –°–¢–†–ê–¢–ï–ì–ò–ô
        // ============================================

        function injectLatestSignalIntoStrategy() {
          const box = document.getElementById('strategyLiveCard');
          if (!box) {
            console.log('‚ùå strategyLiveCard –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
          }

          const selected = window.currentStrategyType || 'TREND';
          
          const signalKey = `lastSignal_${selected}`;
          const lastSignal = JSON.parse(localStorage.getItem(signalKey) || '{}');

          console.log('üîç –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏–≥–Ω–∞–ª–∞ –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:', selected);
          console.log('üîë –ö–ª—é—á localStorage:', signalKey);
          console.log('üì¶ –î–∞–Ω–Ω—ã–µ –∏–∑ localStorage:', lastSignal);

          if (lastSignal && lastSignal.signal && lastSignal.strategy === selected) {
            const signalColors = {
              'BUY': '#00ff9f',
              'SELL': '#ff4d4d',
              'BREAKOUT': '#00d4ff',
              'BREAKDOWN': '#ff8800',
              'TOUCH': '#ffaa00',
              'NEUTRAL': '#888888',
              'HOLD': '#9966ff'
            };

            const signalEmojis = {
              'BUY': 'üìà',
              'SELL': 'üìâ',
              'BREAKOUT': 'üöÄ',
              'BREAKDOWN': '‚¨áÔ∏è',
              'TOUCH': 'üëÜ',
              'NEUTRAL': '‚öñÔ∏è',
              'HOLD': '‚è∏Ô∏è'
            };

            const color = signalColors[lastSignal.signal] || '#888888';
            const emoji = signalEmojis[lastSignal.signal] || 'üìä';
            const time = lastSignal.time || new Date(lastSignal.timestamp).toLocaleTimeString('ru-RU');

            box.innerHTML = `
              <div style="
                background: linear-gradient(135deg, rgba(0,0,0,0.4), rgba(0,0,0,0.2));
                border: 2px solid ${color};
                border-radius: 15px;
                padding: 20px;
                text-align: center;
                box-shadow: 0 0 20px ${color}50;
                animation: pulseGlow 2s infinite;
              ">
                <h3 style="color: ${color}; font-weight: 700; margin-bottom: 15px; font-size: 28px;">
                  ${emoji} ${lastSignal.signal}
                </h3>
                <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; margin-bottom: 10px;">
                  <p style="margin: 8px 0; color: #fff; font-size: 15px;"><b>–°—Ç—Ä–∞—Ç–µ–≥–∏—è:</b> ${lastSignal.strategy.toUpperCase()}</p>
                  <p style="margin: 8px 0; color: #fff; font-size: 15px;"><b>–ú–æ–Ω–µ—Ç–∞:</b> ${lastSignal.symbol}</p>
                  <p style="margin: 8px 0; color: #fff; font-size: 15px;"><b>–¶–µ–Ω–∞:</b> $${lastSignal.price.toFixed(2)}</p>
                  <p style="margin: 8px 0; color: #fff; font-size: 15px;"><b>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:</b> ${lastSignal.confidence}%</p>
                  <p style="margin: 8px 0; color: #888; font-size: 13px;"><b>–í—Ä–µ–º—è:</b> ${time}</p>
                </div>
                <p style="margin-top: 15px; font-size: 14px; opacity: .9; color: #b8c5d1; line-height: 1.6;">
                  ${lastSignal.reason || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}
                </p>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
                  <p style="font-size: 12px; color: #888;">üîÑ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥</p>
                </div>
              </div>
            `;
            
            console.log('‚úÖ –°–∏–≥–Ω–∞–ª –æ—Ç–æ–±—Ä–∞–∂—ë–Ω —É—Å–ø–µ—à–Ω–æ –¥–ª—è:', selected);
          } else {
            box.innerHTML = `
              <div style="color: #777; padding: 30px; text-align: center; background: rgba(255,255,255,0.05); border-radius: 15px; border: 2px dashed rgba(255,255,255,0.1);">
                <div style="font-size: 64px; margin-bottom: 15px; animation: pulse 2s infinite;">üî≠</div>
                <p style="font-size: 18px; margin-bottom: 8px; color: #4facfe;">–û–∂–∏–¥–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤</p>
                <p style="font-size: 13px; opacity: 0.7; color: #888;">–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä—ã–Ω–æ–∫ –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ <b>${selected}</b><br>–°–∏–≥–Ω–∞–ª –ø–æ—è–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
                <div style="margin-top: 20px; padding: 10px; background: rgba(79,172,254,0.1); border-radius: 8px;">
                  <p style="font-size: 12px; color: #4facfe;">‚è±Ô∏è –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥</p>
                </div>
              </div>
            `;
            
            console.log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ –¥–ª—è:', selected);
          }
        }

        function updateBackButton() {
            const backBtn = document.getElementById('floatingBackBtn');
            if (backBtn) {
                if (navigationStack.length > 0) {
                    backBtn.classList.add('show');
                } else {
                    backBtn.classList.remove('show');
                }
            }
        }

        function showStrategy(strategyType) {
          const strategyMap = {
            'trend': 'TREND',
            'TREND': 'TREND',
            'trendline': 'trendline',
            'channel': 'channel'
          };
          
          strategyType = strategyMap[strategyType] || strategyType;
          window.currentStrategyType = strategyType;

          console.log('üéØ –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é:', strategyType);

          navigationStack.push(currentPage);
          currentPage = 'strategyDetail';
          
          document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
          document.getElementById('strategyDetail').classList.add('active');

          const signalBox = document.getElementById('strategyLiveCard');
          if (signalBox) {
            signalBox.innerHTML = `
              <div style="background: rgba(25,25,40,0.8); border-radius: 14px; padding: 15px; color: white; text-align: center;">
                ‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏–≥–Ω–∞–ª–∞...
              </div>
            `;
          }

          setTimeout(() => injectLatestSignalIntoStrategy(), 200);

          const currentCount = parseInt(localStorage.getItem('strategiesUsedCount') || '0');
          localStorage.setItem('strategiesUsedCount', (currentCount + 1).toString());
          if (typeof updateUserStats === 'function') updateUserStats();

          const strategies = {
            TREND: {
              title: "üìà TREND (MA 14)",
              content: "–°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –∞–Ω–∞–ª–∏–∑–µ —Å–∫–æ–ª—å–∑—è—â–µ–π —Å—Ä–µ–¥–Ω–µ–π MA(14). –°–∏–≥–Ω–∞–ª BUY –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ 3 —Å–≤–µ—á–∏ –ø–æ–¥—Ä—è–¥ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤—ã—à–µ TREND, SELL - –∫–æ–≥–¥–∞ –Ω–∏–∂–µ."
            },
            trendline: {
              title: "üìä –ü—Ä–æ–±–æ–π —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –ª–∏–Ω–∏–∏",
              content: "–°—Ç—Ä–∞—Ç–µ–≥–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–≥–∏–∫—É —Ç—Ä–æ–π–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –ª–∏–Ω–∏–∏. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Å–∞–Ω–∏—è –∏ –ø—Ä–æ–±–æ–∏ –ª–∏–Ω–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è."
            },
            channel: {
              title: "üîÄ –¢—Ä–µ–Ω–¥–æ–≤—ã–π –∫–∞–Ω–∞–ª",
              content: "–°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å—Ç—Ä–æ–∏—Ç –≤–æ—Å—Ö–æ–¥—è—â–∏–π/–Ω–∏—Å—Ö–æ–¥—è—â–∏–π –∫–∞–Ω–∞–ª –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –≥—Ä–∞–Ω–∏—Ü –∫–∞–Ω–∞–ª–∞."
            }
          };

          const data = strategies[strategyType];
          if (data) {
            document.getElementById('strategyDetailTitle').textContent = data.title;
            document.getElementById('strategyDetailContent').innerHTML = `
              <p style="color: #b8c5d1; line-height: 1.6; margin-bottom: 20px;">${data.content}</p>
            `;
          }

          updateBackButton();
        }

        window.addEventListener('signalUpdated', (event) => {
          console.log('üîî –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ signalUpdated:', event.detail);
          if (window.currentPage === 'strategyDetail') {
            setTimeout(() => injectLatestSignalIntoStrategy(), 100);
          }
        });

        window.addEventListener('storage', (event) => {
          if (event.key && event.key.startsWith('lastSignal_')) {
            console.log('üíæ –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ localStorage:', event.key);
            if (window.currentPage === 'strategyDetail') {
              setTimeout(() => injectLatestSignalIntoStrategy(), 100);
            }
          }
        });

// –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞–∑–∞–¥
function goBack() {
    if (navigationStack.length > 0) {
        const previousPage = navigationStack.pop();
        showPage(previousPage);
    } else {
        showPage('lessons'); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ –≥–ª–∞–≤–Ω—É—é
    }
}

        console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Å–∏–≥–Ω–∞–ª–æ–≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');

        console.log('TersaaMt Trading App v10.0 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –≥–æ—Ç–æ–≤–∞! üöÄ');
    
    </script>


</style>
<script src="js/live-signals.js"></script>
</body>
</html>




